<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Query Based Custom Clang-Tidy Checks &#8212; Extra Clang Tools 22.1.0-rc1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=e491ac2d" />
    <link rel="stylesheet" href="../_static/clang-tools-extra-styles.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=2797fd66"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Clang-tidy IDE/Editor Integrations" href="Integrations.html" />
    <link rel="prev" title="zircon-temporary-objects" href="checks/zircon/temporary-objects.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>Extra Clang Tools 22.1.0-rc1 documentation</span></a></h1>
        <h2 class="heading"><span>Query Based Custom Clang-Tidy Checks</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="checks/zircon/temporary-objects.html">zircon-temporary-objects</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="Integrations.html">Clang-tidy IDE/Editor Integrations</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="query-based-custom-clang-tidy-checks">
<h1>Query Based Custom Clang-Tidy Checks<a class="headerlink" href="#query-based-custom-clang-tidy-checks" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This page provides examples of how to add query based custom checks for
<strong class="program">clang-tidy</strong>.</p>
<p>Custom checks are based on <strong class="program">clang-query</strong> syntax. Every custom checks
will be registered in <cite>custom</cite> module to avoid name conflict. They can be
enabled or disabled by the checks option like the built-in checks.</p>
<p>Custom checks support inheritance from parent configurations like other
configuration items.</p>
<p>Goals: easy to write, cross platform, multiple versions supported toolkit for
custom clang-tidy rules.
Non-Goals: complex checks, performance, fix-its, etc.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt><cite>CustomChecks</cite> is a list of custom checks. Each check must contain</dt><dd><ul class="simple">
<li><p>Name: check name can be used in <cite>-checks</cite> option.</p></li>
<li><p>Query: <cite>clang-query</cite> string</p></li>
<li><p>Diagnostic: list of diagnostics to be reported.
- BindName: name of the node to be bound in <cite>Query</cite>.
- Message: message to be reported.
- Level: severity of the diagnostic, the possible values are
<cite>Note</cite>, <cite>Warning</cite>.</p></li>
</ul>
</dd>
</dl>
<p><cite>CustomChecks</cite> can be configured by <cite>Checks</cite> option in the configuration file.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Checks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-*,custom-call-main-function</span>
<span class="nt">CustomChecks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">call-main-function</span>
<span class="w">    </span><span class="nt">Query</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">match callExpr(</span>
<span class="w">          </span><span class="no">callee(</span>
<span class="w">            </span><span class="no">functionDecl(isMain()).bind(&quot;fn&quot;)</span>
<span class="w">          </span><span class="no">)</span>
<span class="w">        </span><span class="no">).bind(&quot;callee&quot;)</span>
<span class="w">    </span><span class="nt">Diagnostic</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">BindName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fn</span>
<span class="w">        </span><span class="nt">Message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main function.</span>
<span class="w">        </span><span class="nt">Level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Note</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">BindName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">callee</span>
<span class="w">        </span><span class="nt">Message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">call to main function.</span>
<span class="w">        </span><span class="nt">Level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Warning</span>
</pre></div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">();</span><span class="w"> </span><span class="c1">// note: main function.</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">main</span><span class="p">();</span><span class="w"> </span><span class="c1">// warning: call to main function. [custom-call-main-function]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="matters-need-attention">
<h2>Matters Need Attention<a class="headerlink" href="#matters-need-attention" title="Link to this heading">¶</a></h2>
<p>This feature needs to be explicitly enabled by <cite>–experimental-custom-checks</cite>
because it is currently in the experimental stage. Welcome to submit any
suggestions in the <a class="reference external" href="https://discourse.llvm.org/t/support-query-based-clang-tidy-external-check/85331">link</a>.</p>
<p>During the experimental stage, the required configuration structure of this
feature may be changed in the future. Future changes will be as
forward-compatible as possible, but this is not a guarantee.</p>
<p>In subsequent versions, including non-experimental stage, the query statements
will change at any time. The essence of <strong class="program">clang-query</strong> is to parse the
query string and dynamically generate the corresponding AST matcher.
Therefore, its functionality is entirely dependent on the functions provided by
the AST matcher library.
The ast matcher will change along with the changes in the clang AST.
Please refer to <a class="reference external" href="https://clang.llvm.org/docs/LibASTMatchersReference.html">ast matcher reference</a>.</p>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="checks/zircon/temporary-objects.html">zircon-temporary-objects</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="Integrations.html">Clang-tidy IDE/Editor Integrations</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2007-2026, The Clang Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>