<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Libc++ 21.0.0 (In-Progress) Release Notes &#8212; libc++  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=e491ac2d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>libc++  documentation</span></a></h1>
        <h2 class="heading"><span>Libc++ 21.0.0 (In-Progress) Release Notes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="libc-21-0-0-in-progress-release-notes">
<h1>Libc++ 21.0.0 (In-Progress) Release Notes<a class="headerlink" href="#libc-21-0-0-in-progress-release-notes" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#what-s-new-in-libc-21-0-0" id="id2">What’s New in Libc++ 21.0.0?</a></p>
<ul>
<li><p><a class="reference internal" href="#implemented-papers" id="id3">Implemented Papers</a></p></li>
<li><p><a class="reference internal" href="#improvements-and-new-features" id="id4">Improvements and New Features</a></p></li>
<li><p><a class="reference internal" href="#deprecations-and-removals" id="id5">Deprecations and Removals</a></p></li>
<li><p><a class="reference internal" href="#potentially-breaking-changes" id="id6">Potentially breaking changes</a></p></li>
<li><p><a class="reference internal" href="#announcements-about-future-releases" id="id7">Announcements About Future Releases</a></p></li>
<li><p><a class="reference internal" href="#abi-affecting-changes" id="id8">ABI Affecting Changes</a></p></li>
<li><p><a class="reference internal" href="#build-system-changes" id="id9">Build System Changes</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>Written by the <a class="reference external" href="https://libcxx.llvm.org">Libc++ Team</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These are in-progress notes for the upcoming libc++ 21.0.0 release.
Release notes for previous releases can be found on
<a class="reference external" href="https://releases.llvm.org/download.html">the Download Page</a>.</p>
</div>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This document contains the release notes for the libc++ C++ Standard Library,
part of the LLVM Compiler Infrastructure, release 21.0.0. Here we describe the
status of libc++ in some detail, including major improvements from the previous
release and new feature work. For the general LLVM release notes, see <a class="reference external" href="https://llvm.org/docs/ReleaseNotes.html">the LLVM
documentation</a>. All LLVM releases may
be downloaded from the <a class="reference external" href="https://llvm.org/releases/">LLVM releases web site</a>.</p>
<p>For more information about libc++, please see the <a class="reference external" href="https://libcxx.llvm.org">Libc++ Web Site</a> or the <a class="reference external" href="https://llvm.org">LLVM Web Site</a>.</p>
<p>Note that if you are reading this file from a Git checkout or the
main Libc++ web page, this document applies to the <em>next</em> release, not
the current one. To see the release notes for a specific release, please
see the <a class="reference external" href="https://llvm.org/releases/">releases page</a>.</p>
</section>
<section id="what-s-new-in-libc-21-0-0">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">What’s New in Libc++ 21.0.0?</a><a class="headerlink" href="#what-s-new-in-libc-21-0-0" title="Link to this heading">¶</a></h2>
<section id="implemented-papers">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Implemented Papers</a><a class="headerlink" href="#implemented-papers" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>N4258: Cleaning-up noexcept in the Library (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/99937">Github</a>)</p></li>
<li><p>P0767R1: Deprecate POD (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/104013">Github</a>)</p></li>
<li><p>P1361R2: Integration of chrono with text formatting (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/100014">Github</a>)</p></li>
<li><p>P2255R2: A type trait to detect reference binding to temporary (implemented the type traits only) (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/105180">Github</a>)</p></li>
<li><p>P2372R3: Fixing locale handling in chrono formatters (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/100043">Github</a>)</p></li>
<li><p>P2562R1: <code class="docutils literal notranslate"><span class="pre">constexpr</span></code> Stable Sorting (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/105360">Github</a>)</p></li>
<li><p>P0472R3: Put std::monostate in &lt;utility&gt; (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/127874">Github</a>)</p></li>
<li><p>P1222R4: A Standard <code class="docutils literal notranslate"><span class="pre">flat_set</span></code> (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/105193">Github</a>)</p></li>
<li><p>P2897R7: <code class="docutils literal notranslate"><span class="pre">aligned_accessor</span></code>: An mdspan accessor expressing pointer over-alignment (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/118372">Github</a>)</p></li>
<li><p>P3247R2: Deprecate the notion of trivial types (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/118387">Github</a>)</p></li>
<li><p>P3372R3: <code class="docutils literal notranslate"><span class="pre">constexpr</span></code> containers and adaptors (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/127876">Github</a>) (<code class="docutils literal notranslate"><span class="pre">forward_list</span></code>, <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">priority_queue</span></code>, <code class="docutils literal notranslate"><span class="pre">flat_map</span></code>, and <code class="docutils literal notranslate"><span class="pre">flat_set</span></code> are implemented)</p></li>
<li><p>P2441R2: <code class="docutils literal notranslate"><span class="pre">views::join_with</span></code> (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/105185">Github</a>)</p></li>
<li><p>P2711R1: Making multi-param constructors of <code class="docutils literal notranslate"><span class="pre">views</span></code> <code class="docutils literal notranslate"><span class="pre">explicit</span></code> (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/105252">Github</a>)</p></li>
<li><p>P2770R0: Stashing stashing <code class="docutils literal notranslate"><span class="pre">iterators</span></code> for proper flattening (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/105250">Github</a>)</p></li>
<li><p>P2655R3: <code class="docutils literal notranslate"><span class="pre">common_reference_t</span></code> of <code class="docutils literal notranslate"><span class="pre">reference_wrapper</span></code> Should Be a Reference Type (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/105260">Github</a>)</p></li>
<li><p>P3379R0: Constrain <code class="docutils literal notranslate"><span class="pre">std::expected</span></code> equality operators (<a class="reference external" href="https://github.com/llvm/llvm-project/issues/118135">Github</a>)</p></li>
</ul>
</section>
<section id="improvements-and-new-features">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Improvements and New Features</a><a class="headerlink" href="#improvements-and-new-features" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">std::ranges::{copy,</span> <span class="pre">copy_n,</span> <span class="pre">copy_backward,</span> <span class="pre">move,</span> <span class="pre">move_backward,</span> <span class="pre">rotate}</span></code> algorithms have been optimized for
<code class="docutils literal notranslate"><span class="pre">std::vector&lt;bool&gt;::iterator</span></code>, resulting in a performance improvement of up to 2000x.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">std::ranges::equal</span></code> algorithm has been optimized for <code class="docutils literal notranslate"><span class="pre">std::vector&lt;bool&gt;::iterator</span></code>, resulting in a performance
improvement of up to 188x.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">std::ranges::swap_ranges</span></code> algorithm has been optimized for <code class="docutils literal notranslate"><span class="pre">std::vector&lt;bool&gt;::iterator</span></code>, resulting in a
performance improvement of up to 611x.</p></li>
<li><p>Updated formatting library to Unicode 16.0.0.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">num_put::do_put</span></code> integral overloads have been optimized, resulting in a performance improvement of up to 2.4x.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">std::stable_sort</span></code> algorithm uses radix sort for floating-point types now, which can improve the performance
up to 10x, depending on type of sorted elements and the initial state of the sorted array.</p></li>
<li><p>The segmented iterator optimization for <code class="docutils literal notranslate"><span class="pre">std::for_each</span></code> has been backported to C++11. Previously it was only available
in C++23 and later.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">std::for_each_n</span></code>, <code class="docutils literal notranslate"><span class="pre">std::ranges::for_each</span></code> and <code class="docutils literal notranslate"><span class="pre">std::ranges::for_each_n</span></code> algorithms have been optimized for
segmented iterators, resulting in a performance improvement of up to 17.7x for <code class="docutils literal notranslate"><span class="pre">std::deque&lt;short&gt;</span></code> iterators, and up
to 13.9x for <code class="docutils literal notranslate"><span class="pre">std::join_view&lt;vector&lt;vector&lt;short&gt;&gt;&gt;</span></code> iterators.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">bitset::to_string</span></code> function has been optimized, resulting in a performance improvement of up to 8.3x for bitsets
with uniformly distributed zeros and ones, and up to 13.5x and 16.1x for sparse and dense bitsets, respectively.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">flat_map::insert</span></code> and <code class="docutils literal notranslate"><span class="pre">flat_set::insert_range</span></code> have been optimized, resulting in a performance improvement of up
to 10x for inserting elements into a <code class="docutils literal notranslate"><span class="pre">flat_map</span></code> when the input range is a <code class="docutils literal notranslate"><span class="pre">flat_map</span></code> or a <code class="docutils literal notranslate"><span class="pre">zip_view</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ctype::tolower</span></code> and <code class="docutils literal notranslate"><span class="pre">ctype::toupper</span></code> have been optimized, resulting in a 2x performance improvement.</p></li>
<li><p>As an experimental feature, Hardening now supports assertion semantics that allow customizing how a hardening
assertion failure is handled. The four available semantics, modeled on C++26 Contracts, are <code class="docutils literal notranslate"><span class="pre">ignore</span></code>, <code class="docutils literal notranslate"><span class="pre">observe</span></code>,
<code class="docutils literal notranslate"><span class="pre">quick-enforce</span></code> and <code class="docutils literal notranslate"><span class="pre">enforce</span></code>. The <code class="docutils literal notranslate"><span class="pre">observe</span></code> semantic is intended to make it easier to adopt Hardening in
production but should not be used outside of this scenario. Please refer to the <a class="reference internal" href="../Hardening.html#hardening"><span class="std std-ref">Hardening documentation</span></a> for details.</p></li>
</ul>
</section>
<section id="deprecations-and-removals">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Deprecations and Removals</a><a class="headerlink" href="#deprecations-and-removals" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">std::is_pod</span></code> and <code class="docutils literal notranslate"><span class="pre">std::is_pod_v</span></code> are deprecated in C++20 and later.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std::is_trivial</span></code> and <code class="docutils literal notranslate"><span class="pre">std::is_trivial_v</span></code> are deprecated in C++26 and later.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_VERBOSE_ABORT_NOT_NOEXCEPT</span></code> has been removed, making <code class="docutils literal notranslate"><span class="pre">std::__libcpp_verbose_abort</span></code>
unconditionally <code class="docutils literal notranslate"><span class="pre">noexcept</span></code>.</p></li>
<li><p>libc++ no longer adds <code class="docutils literal notranslate"><span class="pre">constexpr</span></code> to <code class="docutils literal notranslate"><span class="pre">std::hash&lt;std::vector&lt;bool,</span> <span class="pre">A&gt;&gt;::operator()</span></code>, as the <code class="docutils literal notranslate"><span class="pre">constexpr</span></code> addition
since C++20 was an unintended extension.</p></li>
<li><p>The non-conforming extension <code class="docutils literal notranslate"><span class="pre">packaged_task::result_type</span></code> has been removed in LLVM 21.</p></li>
</ul>
</section>
<section id="potentially-breaking-changes">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Potentially breaking changes</a><a class="headerlink" href="#potentially-breaking-changes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>The implementation of <code class="docutils literal notranslate"><span class="pre">num_put::do_put</span></code> has been replaced to improve the performance, which can lead to different
output when printing pointers.</p></li>
<li><p>User-defined specializations of <code class="docutils literal notranslate"><span class="pre">std::common_reference</span></code> are diagnosed now. To customize the common reference type, <code class="docutils literal notranslate"><span class="pre">std::basic_common_reference</span></code> should be specialized instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std::function</span></code> used to have allocator support, which was removed from the Standard by <cite>http://wg21.link/p0302r1</cite>
due to issues with its design and inconsistent support from implementations. Previously, libc++ would provide
allocator-aware APIs in <code class="docutils literal notranslate"><span class="pre">std::function</span></code> in C++11 and C++14, but ignores the allocator argument in all places but
one. Starting in this release, the allocator argument is always ignored.</p></li>
</ul>
</section>
<section id="announcements-about-future-releases">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Announcements About Future Releases</a><a class="headerlink" href="#announcements-about-future-releases" title="Link to this heading">¶</a></h3>
<section id="llvm-22">
<h4>LLVM 22<a class="headerlink" href="#llvm-22" title="Link to this heading">¶</a></h4>
<ul>
<li><p>The status of the C++03 implementation will be frozen after the LLVM 21 release. This means that starting in LLVM 22,
non-critical bug fixes may not be back-ported to C++03, including LWG issues. C++03 is a legacy platform, where most
projects are no longer actively maintained. To reduce the amount of fixes required to keep such legacy projects
compiling with up-to-date toolchains, libc++ will aim to freeze the status of the headers in C++03 mode to avoid
unintended breaking changes. See <a class="reference external" href="https://discourse.llvm.org/t/rfc-freezing-c-03-headers-in-libc">https://discourse.llvm.org/t/rfc-freezing-c-03-headers-in-libc</a> for more details.</p>
<p>If you are using C++03 in your project, you should consider moving to a newer version of the Standard to get the most
out of libc++.</p>
</li>
</ul>
</section>
</section>
<section id="abi-affecting-changes">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">ABI Affecting Changes</a><a class="headerlink" href="#abi-affecting-changes" title="Link to this heading">¶</a></h3>
<ul>
<li><p>When using GCC, the <code class="docutils literal notranslate"><span class="pre">std</span></code> namespace is now annotated with <code class="docutils literal notranslate"><span class="pre">[[gnu::visibility(&quot;default&quot;)]]</span></code>. This may cause more
symbols to be exported from shared libraries when building with <code class="docutils literal notranslate"><span class="pre">-fvisibility=hidden</span></code>. This also fixes RTTI
comparison between shared libraries, since all RTTI has the correct visibility now. There is no behaviour change on
Clang.</p></li>
<li><p>LLVM 20 contained an ABI break that can result in the size of <code class="docutils literal notranslate"><span class="pre">std::unordered_{map,set,multimap,multiset}</span></code> and <code class="docutils literal notranslate"><span class="pre">std::deque</span></code> changing when used with an allocator type that is empty and contains a base class that is the same across rebound allocator instantiations (e.g. <code class="docutils literal notranslate"><span class="pre">Allocator&lt;int&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">Allocator&lt;char&gt;</span></code> are both empty and contain the same base class).
In addition, the layout of a user-defined type that:</p>
<blockquote>
<div><ul class="simple">
<li><p>contains one of the following containers: <code class="docutils literal notranslate"><span class="pre">std::unordered_{map,set,multimap,multiset}</span></code>, <code class="docutils literal notranslate"><span class="pre">std::deque</span></code>, <code class="docutils literal notranslate"><span class="pre">std::map</span></code>, <code class="docutils literal notranslate"><span class="pre">std::set</span></code>, <code class="docutils literal notranslate"><span class="pre">std::multimap</span></code>, <code class="docutils literal notranslate"><span class="pre">std::multiset</span></code>, <code class="docutils literal notranslate"><span class="pre">std::list</span></code> or <code class="docutils literal notranslate"><span class="pre">std::vector</span></code>, and</p></li>
<li><p>passes an empty allocator, comparator or hasher type to that container, and</p></li>
<li><p>has a member of that same empty allocator, comparator or hasher type inside the enclosing struct, and</p></li>
<li><p>that member is either marked with <code class="docutils literal notranslate"><span class="pre">[[no_unique_address]]</span></code> or optimized out via the EBO (empty base optimization) technique</p></li>
</ul>
</div></blockquote>
<p>saw its size increase from LLVM 19 to LLVM 20. This was caused by the usage of <code class="docutils literal notranslate"><span class="pre">[[no_unique_address]]</span></code> within some of libc++’s containers in a way that allowed subtle interactions with enclosing objects. This is fixed in LLVM 21 when using the Clang compiler (returning to the LLVM 19 ABI), however that implies an ABI break from LLVM 20 to LLVM 21.</p>
<p>Furthermore, fixing this causes a slight regression to constant evaluation support in <code class="docutils literal notranslate"><span class="pre">std::unique_ptr</span></code>. Specifically, constant evaluation will now fail when the deleter relies on being value-initialized for constant-evaluation admissibility. If a default-initialized deleter can be used during constant evaluation, or if the default constructor is non-trivial, the <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code> is not affected by this regression. In particular, this regression does not impact any <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code> using the default deleter.</p>
<p>Note that there is currently no way to realistically fix this ABI break on GCC, therefore GCC will remain on the ABI introduced in LLVM 19. That also means that Clang and GCC will have a slightly different ABI for the small subset of types listed above until we are able to apply the same fix we did with Clang on GCC.</p>
<p>For more details see <a class="reference external" href="https://llvm.org/PR154146">https://llvm.org/PR154146</a>.</p>
</li>
</ul>
</section>
<section id="build-system-changes">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Build System Changes</a><a class="headerlink" href="#build-system-changes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>TODO</p></li>
</ul>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2011-2025, LLVM Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>