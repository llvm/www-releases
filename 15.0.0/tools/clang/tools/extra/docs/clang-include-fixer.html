
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clang-Include-Fixer &#8212; Extra Clang Tools 15.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <link rel="stylesheet" href="_static/clang-tools-extra-styles.css" type="text/css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Modularize User’s Manual" href="modularize.html" />
    <link rel="prev" title="Getting Involved" href="clang-tidy/Contributing.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Extra Clang Tools 15.0.0 documentation</span></a></h1>
        <h2 class="heading"><span>Clang-Include-Fixer</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="clang-tidy/Contributing.html">Getting Involved</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="modularize.html">Modularize User’s Manual</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <div class="section" id="clang-include-fixer">
<h1><a class="toc-backref" href="#id1">Clang-Include-Fixer</a><a class="headerlink" href="#clang-include-fixer" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#clang-include-fixer" id="id1">Clang-Include-Fixer</a></p>
<ul>
<li><p><a class="reference internal" href="#setup" id="id2">Setup</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-a-symbol-index-from-a-compilation-database" id="id3">Creating a Symbol Index From a Compilation Database</a></p></li>
<li><p><a class="reference internal" href="#integrate-with-vim" id="id4">Integrate with Vim</a></p></li>
<li><p><a class="reference internal" href="#integrate-with-emacs" id="id5">Integrate with Emacs</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-it-works" id="id6">How it Works</a></p></li>
</ul>
</li>
</ul>
</div>
<p>One of the major nuisances of C++ compared to other languages is the manual
management of <code class="docutils literal notranslate"><span class="pre">#include</span></code> directives in any file.
<strong class="program">clang-include-fixer</strong> addresses one aspect of this problem by providing
an automated way of adding <code class="docutils literal notranslate"><span class="pre">#include</span></code> directives for missing symbols in one
translation unit.</p>
<p>While inserting missing <code class="docutils literal notranslate"><span class="pre">#include</span></code>, <strong class="program">clang-include-fixer</strong> adds
missing namespace qualifiers to all instances of an unidentified symbol if
the symbol is missing some prefix namespace qualifiers.</p>
<div class="section" id="setup">
<h2><a class="toc-backref" href="#id2">Setup</a><a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>To use <strong class="program">clang-include-fixer</strong> two databases are required. Both can be
generated with existing tools.</p>
<ul class="simple">
<li><p>Compilation database. Contains the compiler commands for any given file in a
project and can be generated by CMake, see <a class="reference external" href="https://clang.llvm.org/docs/HowToSetupToolingForLLVM.html">How To Setup Tooling For LLVM</a>.</p></li>
<li><p>Symbol index. Contains all symbol information in a project to match a given
identifier to a header file.</p></li>
</ul>
<p>Ideally both databases (<code class="docutils literal notranslate"><span class="pre">compile_commands.json</span></code> and
<code class="docutils literal notranslate"><span class="pre">find_all_symbols_db.yaml</span></code>) are linked into the root of the source tree they
correspond to. Then the <strong class="program">clang-include-fixer</strong> can automatically pick
them up if called with a source file from that tree. Note that by default
<code class="docutils literal notranslate"><span class="pre">compile_commands.json</span></code> as generated by CMake does not include header files,
so only implementation files can be handled by tools.</p>
<div class="section" id="creating-a-symbol-index-from-a-compilation-database">
<h3><a class="toc-backref" href="#id3">Creating a Symbol Index From a Compilation Database</a><a class="headerlink" href="#creating-a-symbol-index-from-a-compilation-database" title="Permalink to this headline">¶</a></h3>
<p>The include fixer contains <strong class="program">find-all-symbols</strong>, a tool to create a
symbol database in YAML format from a compilation database by parsing all
source files listed in it. The following list of commands shows how to set up a
database for LLVM, any project built by CMake should follow similar steps.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> path/to/llvm-build
<span class="gp">$ </span>ninja find-all-symbols // build find-all-symbols tool.
<span class="gp">$ </span>ninja clang-include-fixer // build clang-include-fixer tool.
<span class="gp">$ </span>ls compile_commands.json <span class="c1"># Make sure compile_commands.json exists.</span>
<span class="go">  compile_commands.json</span>
<span class="gp">$ </span>path/to/llvm/source/clang-tools-extra/clang-include-fixer/find-all-symbols/tool/run-find-all-symbols.py
<span class="go">  ... wait as clang indexes the code base ...</span>
<span class="gp">$ </span>ln -s <span class="nv">$PWD</span>/find_all_symbols_db.yaml path/to/llvm/source/ <span class="c1"># Link database into the source tree.</span>
<span class="gp">$ </span>ln -s <span class="nv">$PWD</span>/compile_commands.json path/to/llvm/source/ <span class="c1"># Also link compilation database if it&#39;s not there already.</span>
<span class="gp">$ </span><span class="nb">cd</span> path/to/llvm/source
<span class="gp">$ </span>/path/to/clang-include-fixer -db<span class="o">=</span>yaml path/to/file/with/missing/include.cpp
<span class="go">  Added #include &quot;foo.h&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="integrate-with-vim">
<h3><a class="toc-backref" href="#id4">Integrate with Vim</a><a class="headerlink" href="#integrate-with-vim" title="Permalink to this headline">¶</a></h3>
<p>To run <cite>clang-include-fixer</cite> on a potentially unsaved buffer in Vim. Add the
following key binding to your <code class="docutils literal notranslate"><span class="pre">.vimrc</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">noremap &lt;leader&gt;cf :pyf path/to/llvm/source/clang-tools-extra/clang-include-fixer/tool/clang-include-fixer.py&lt;cr&gt;</span>
</pre></div>
</div>
<p>This enables <cite>clang-include-fixer</cite> for NORMAL and VISUAL mode. Change
<cite>&lt;leader&gt;cf</cite> to another binding if you need clang-include-fixer on a different
key. The <a class="reference external" href="http://vim.wikia.com/wiki/Mapping_keys_in_Vim_-_Tutorial_(Part_3)#Map_leader">&lt;leader&gt; key</a>
is a reference to a specific key defined by the mapleader variable and is bound
to backslash by default.</p>
<p>Make sure vim can find <strong class="program">clang-include-fixer</strong>:</p>
<ul class="simple">
<li><p>Add the path to <strong class="program">clang-include-fixer</strong> to the PATH environment variable.</p></li>
<li><p>Or set <code class="docutils literal notranslate"><span class="pre">g:clang_include_fixer_path</span></code> in vimrc: <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">g:clang_include_fixer_path=path/to/clang-include-fixer</span></code></p></li>
</ul>
<p>You can customize the number of headers being shown by setting
<code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">g:clang_include_fixer_maximum_suggested_headers=5</span></code></p>
<p>Customized settings in <cite>.vimrc</cite>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">g:clang_include_fixer_path</span> <span class="pre">=</span> <span class="pre">&quot;clang-include-fixer&quot;</span></code></p>
<p>Set clang-include-fixer binary file path.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">g:clang_include_fixer_maximum_suggested_headers</span> <span class="pre">=</span> <span class="pre">3</span></code></p>
<p>Set the maximum number of <code class="docutils literal notranslate"><span class="pre">#includes</span></code> to show. Default is 3.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">g:clang_include_fixer_increment_num</span> <span class="pre">=</span> <span class="pre">5</span></code></p>
<p>Set the increment number of #includes to show every time when pressing <code class="docutils literal notranslate"><span class="pre">m</span></code>.
Default is 5.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">g:clang_include_fixer_jump_to_include</span> <span class="pre">=</span> <span class="pre">0</span></code></p>
<p>Set to 1 if you want to jump to the new inserted <code class="docutils literal notranslate"><span class="pre">#include</span></code> line. Default is
0.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">g:clang_include_fixer_query_mode</span> <span class="pre">=</span> <span class="pre">0</span></code></p>
<p>Set to 1 if you want to insert <code class="docutils literal notranslate"><span class="pre">#include</span></code> for the symbol under the cursor.
Default is 0. Compared to normal mode, this mode won’t parse the source file
and only search the symbol from database, which is faster than normal mode.</p>
</li>
</ul>
<p>See <code class="docutils literal notranslate"><span class="pre">clang-include-fixer.py</span></code> for more details.</p>
</div>
<div class="section" id="integrate-with-emacs">
<h3><a class="toc-backref" href="#id5">Integrate with Emacs</a><a class="headerlink" href="#integrate-with-emacs" title="Permalink to this headline">¶</a></h3>
<p>To run <cite>clang-include-fixer</cite> on a potentially unsaved buffer in Emacs.
Ensure that Emacs finds <code class="docutils literal notranslate"><span class="pre">clang-include-fixer.el</span></code> by adding the directory
containing the file to the <code class="docutils literal notranslate"><span class="pre">load-path</span></code> and requiring the <cite>clang-include-fixer</cite>
in your <code class="docutils literal notranslate"><span class="pre">.emacs</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">(add-to-list &#39;load-path &quot;path/to/llvm/source/clang-tools-extra/clang-include-fixer/tool/&quot;</span>
<span class="gp gp-VirtualEnv">(require &#39;clang-include-fixer)</span>
</pre></div>
</div>
<p>Within Emacs the tool can be invoked with the command
<code class="docutils literal notranslate"><span class="pre">M-x</span> <span class="pre">clang-include-fixer</span></code>. This will insert the header that defines the
first undefined symbol; if there is more than one header that would define the
symbol, the user is prompted to select one.</p>
<p>To include the header that defines the symbol at point, run
<code class="docutils literal notranslate"><span class="pre">M-x</span> <span class="pre">clang-include-fixer-at-point</span></code>.</p>
<p>Make sure Emacs can find <strong class="program">clang-include-fixer</strong>:</p>
<ul class="simple">
<li><p>Either add the parent directory of <strong class="program">clang-include-fixer</strong> to the PATH
environment variable, or customize the Emacs user option
<code class="docutils literal notranslate"><span class="pre">clang-include-fixer-executable</span></code> to point to the file name of the program.</p></li>
</ul>
</div>
</div>
<div class="section" id="how-it-works">
<h2><a class="toc-backref" href="#id6">How it Works</a><a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>To get the most information out of Clang at parse time,
<strong class="program">clang-include-fixer</strong> runs in tandem with the parse and receives
callbacks from Clang’s semantic analysis. In particular it reuses the existing
support for typo corrections. Whenever Clang tries to correct a potential typo
it emits a callback to the include fixer which then looks for a corresponding
file. At this point rich lookup information is still available, which is not
available in the AST at a later stage.</p>
<p>The identifier that should be typo corrected is then sent to the database, if a
header file is returned it is added as an include directive at the top of the
file.</p>
<p>Currently <strong class="program">clang-include-fixer</strong> only inserts a single include at a
time to avoid getting caught in follow-up errors. If multiple <cite>#include</cite>
additions are desired the program can be rerun until a fix-point is reached.</p>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="clang-tidy/Contributing.html">Getting Involved</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="modularize.html">Modularize User’s Manual</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2007-2022, The Clang Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>