<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contributing to libc++ &#8212; libc++  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=e491ac2d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="libc++ Coding Guidelines" href="CodingGuidelines.html" />
    <link rel="prev" title="libc++’s ABI Guarantees" href="ABIGuarantees.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>libc++  documentation</span></a></h1>
        <h2 class="heading"><span>Contributing to libc++</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="ABIGuarantees.html">libc++’s ABI Guarantees</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="CodingGuidelines.html">libc++ Coding Guidelines</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="contributing-to-libc">
<span id="contributingtolibcxx"></span><h1>Contributing to libc++<a class="headerlink" href="#contributing-to-libc" title="Link to this heading">¶</a></h1>
<p>This file contains information useful when contributing to libc++. If this is your first time contributing,
please also read <a class="reference external" href="https://www.llvm.org/docs/Contributing.html">this document</a> on general rules for
contributing to LLVM.</p>
<p>If you plan on contributing to libc++, it can be useful to join the <code class="docutils literal notranslate"><span class="pre">#libcxx</span></code> channel
on <a class="reference external" href="https://discord.gg/jzUbyP26tQ">LLVM’s Discord server</a>.</p>
<section id="looking-for-pre-existing-pull-requests">
<h2>Looking for pre-existing pull requests<a class="headerlink" href="#looking-for-pre-existing-pull-requests" title="Link to this heading">¶</a></h2>
<p>Before you start working on any feature, please take a look at the open libc++ pull
requests to avoid duplicating someone else’s work. You can do that on GitHub by
filtering pull requests <a class="reference external" href="https://github.com/llvm/llvm-project/pulls?q=is%3Apr+is%3Aopen+label%3Alibc%2B%2B">tagged with libc++</a>.
If you see that your feature is already being worked on, please consider chiming in
and helping review the code instead of duplicating work!</p>
</section>
<section id="rfcs-for-significant-user-affecting-changes">
<h2>RFCs for significant user-affecting changes<a class="headerlink" href="#rfcs-for-significant-user-affecting-changes" title="Link to this heading">¶</a></h2>
<p>Before you start working on a change that can have significant impact on users of the library,
please consider creating a RFC on the <a class="reference external" href="https://discourse.llvm.org/c/runtimes/libcxx">libc++ forum</a>.
This will ensure that you work in a direction that the project endorses and will ease reviewing your
contribution as directional questions can be raised early. Including a WIP patch is not mandatory,
but it can be useful to ground the discussion in something concrete.</p>
</section>
<section id="writing-tests-and-running-the-test-suite">
<h2>Writing tests and running the test suite<a class="headerlink" href="#writing-tests-and-running-the-test-suite" title="Link to this heading">¶</a></h2>
<p>Every change in libc++ must come with appropriate tests. Libc++ has an extensive test suite that
should be run locally by developers before submitting patches and is also run as part of our CI
infrastructure. The documentation about writing tests and running them is <a class="reference internal" href="TestingLibcxx.html#testing"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="coding-guidelines">
<h2>Coding Guidelines<a class="headerlink" href="#coding-guidelines" title="Link to this heading">¶</a></h2>
<p>libc++’s coding guidelines are documented <a class="reference internal" href="CodingGuidelines.html#codingguidelines"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Link to this heading">¶</a></h2>
<section id="libc-specific">
<h3>Libc++ specific<a class="headerlink" href="#libc-specific" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">libcxx/include/__config</span></code> – this file contains the commonly used
macros in libc++. Libc++ supports all C++ language versions. Newer versions
of the Standard add new features. For example, making functions <code class="docutils literal notranslate"><span class="pre">constexpr</span></code>
in C++20 is done by using <code class="docutils literal notranslate"><span class="pre">_LIBCPP_CONSTEXPR_SINCE_CXX20</span></code>. This means the
function is <code class="docutils literal notranslate"><span class="pre">constexpr</span></code> in C++20 and later. The Standard does not allow
making this available in C++17 or earlier, so we use a macro to implement
this requirement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">libcxx/test/support/test_macros.h</span></code> – similar to the above, but for the
test suite.</p></li>
</ul>
</section>
<section id="iso-c-standard">
<h3>ISO C++ Standard<a class="headerlink" href="#iso-c-standard" title="Link to this heading">¶</a></h3>
<p>Libc++ implements the library part of the ISO C++ standard. The official
publication must be bought from ISO or your national body. This is not
needed to work on libc++, there are other free resources available.</p>
<ul class="simple">
<li><p>The <a class="reference external" href="https://github.com/cplusplus/draft">LaTeX sources</a>  used to
create the official C++ standard. This can be used to create your own
unofficial build of the standard.</p></li>
<li><p>An <a class="reference external" href="https://eel.is/c++draft/">HTML rendered version of the draft</a>  is
available. This is the most commonly used place to look for the
wording of the standard.</p></li>
<li><p>An <a class="reference external" href="https://github.com/timsong-cpp/cppwp">alternative</a> is available.
This link has both recent and historic versions of the standard.</p></li>
<li><p>When implementing features, there are
<a class="reference external" href="https://eel.is/c++draft/#library">general requirements</a>.
Most papers use this
<a class="reference external" href="http://eel.is/c++draft/structure#specifications">jargon</a>
to describe how library functions work.</p></li>
<li><p>The <a class="reference external" href="https://wg21.link/">WG21 redirect service</a> is a tool to quickly locate
papers, issues, and wording in the standard.</p></li>
<li><p>The <a class="reference external" href="https://github.com/cplusplus/papers/issues">paper trail</a> of
papers is publicly available, including the polls taken. It
contains links to the minutes of paper’s discussion. Per ISO rules,
these minutes are only accessible by members of the C++ committee.</p></li>
<li><p><a class="reference external" href="https://isocpp.org/std/standing-documents/sd-6-sg10-feature-test-recommendations">Feature-Test Macros and Policies</a>
contains information about feature-test macros in C++.
It contains a list with all feature-test macros, their versions, and the paper
that introduced them.</p></li>
<li><p><a class="reference external" href="https://en.cppreference.com/w/">cppreference</a> is a good resource
for the usage of C++ library and language features. It’s easier to
read than the C++ Standard, but it lacks details needed to properly implement
library features.</p></li>
</ul>
</section>
</section>
<section id="pre-commit-check-list">
<h2>Pre-commit check list<a class="headerlink" href="#pre-commit-check-list" title="Link to this heading">¶</a></h2>
<p>Before committing or creating a review, please go through this check-list to make
sure you don’t forget anything:</p>
<ul class="simple">
<li><p>Do you have <a class="reference internal" href="TestingLibcxx.html#testing"><span class="std std-ref">tests</span></a> for every public class and/or function you’re adding or modifying?</p></li>
<li><p>Did you update the synopsis of the relevant headers?</p></li>
<li><p>Did you update the relevant files to track implementation status (in <code class="docutils literal notranslate"><span class="pre">docs/Status/</span></code>)?</p></li>
<li><p>Did you mark all functions and type declarations with the <a class="reference internal" href="DesignDocs/VisibilityMacros.html#visibility-macros"><span class="std std-ref">proper visibility macro</span></a>?</p></li>
<li><p>Did you add all new named declarations to the <code class="docutils literal notranslate"><span class="pre">std</span></code> module?</p></li>
<li><p>If you added a header:</p>
<ul>
<li><p>Did you add it to <code class="docutils literal notranslate"><span class="pre">include/module.modulemap.in</span></code>?</p></li>
<li><p>Did you add it to <code class="docutils literal notranslate"><span class="pre">include/CMakeLists.txt</span></code>?</p></li>
<li><p>If it’s a public header, did you update <code class="docutils literal notranslate"><span class="pre">utils/libcxx/header_information.py</span></code>?</p></li>
</ul>
</li>
<li><p>Did you add the relevant feature test macro(s) for your feature? Did you update the <code class="docutils literal notranslate"><span class="pre">generate_feature_test_macro_components.py</span></code> script with it?</p></li>
<li><p>Did you run the <code class="docutils literal notranslate"><span class="pre">libcxx-generate-files</span></code> target and verify its output?</p></li>
<li><p>If needed, did you add <code class="docutils literal notranslate"><span class="pre">_LIBCPP_PUSH_MACROS</span></code> and <code class="docutils literal notranslate"><span class="pre">_LIBCPP_POP_MACROS</span></code> to the relevant headers?</p></li>
</ul>
</section>
<section id="the-review-process">
<h2>The review process<a class="headerlink" href="#the-review-process" title="Link to this heading">¶</a></h2>
<p>After uploading your patch, you should see that the “libc++” review group is automatically
added as a reviewer for your patch. Once the group is marked as having approved your patch,
you can commit it. However, if you get an approval very quickly for a significant patch,
please try to wait a couple of business days before committing to give the opportunity for
other reviewers to chime in. If you need someone else to commit the patch for you, please
mention it and provide your <code class="docutils literal notranslate"><span class="pre">Name</span> <span class="pre">&lt;email&#64;domain&gt;</span></code> for us to attribute the commit properly.</p>
<p>Note that the rule for accepting as the “libc++” review group is to wait for two members
of the group to have approved the patch, excluding the patch author. This is not a hard
rule – for very simple patches, use your judgement. The <a class="reference external" href="https://reviews.llvm.org/project/members/64/">“libc++” review group</a>
consists of frequent libc++ contributors with a good understanding of the project’s
guidelines – if you would like to be added to it, please reach out on Discord.</p>
<p>Some tips:</p>
<ul class="simple">
<li><p>Keep the number of formatting changes in patches minimal.</p></li>
<li><p>Provide separate patches for style fixes and for bug fixes or features. Keep in
mind that large formatting patches may cause merge conflicts with other patches
under review. In general, we prefer to avoid large reformatting patches.</p></li>
<li><p>Keep patches self-contained. Large and/or complicated patches are harder to
review and take a significant amount of time. It’s fine to have multiple
patches to implement one feature if the feature can be split into
self-contained sub-tasks.</p></li>
</ul>
</section>
<section id="exporting-new-symbols-from-the-library">
<h2>Exporting new symbols from the library<a class="headerlink" href="#exporting-new-symbols-from-the-library" title="Link to this heading">¶</a></h2>
<p>When exporting new symbols from libc++, you must update the ABI lists located in <code class="docutils literal notranslate"><span class="pre">lib/abi</span></code>.
To test whether the lists are up-to-date, please run the target <code class="docutils literal notranslate"><span class="pre">check-cxx-abilist</span></code>.
To regenerate the lists, use the target <code class="docutils literal notranslate"><span class="pre">generate-cxx-abilist</span></code>.
The ABI lists must be updated for all supported platforms; currently Linux and
Apple.  If you don’t have access to one of these platforms, you can download an
updated list from the failed build at
<a class="reference external" href="https://buildkite.com/llvm-project/libcxx-ci">Buildkite</a>.
Look for the failed build and select the <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> tab. There, download the
abilist for the platform, e.g.:</p>
<ul class="simple">
<li><p>C++&lt;version&gt;.</p></li>
<li><p>MacOS X86_64 and MacOS arm64 for the Apple platform.</p></li>
</ul>
</section>
<section id="pre-commit-ci">
<h2>Pre-commit CI<a class="headerlink" href="#pre-commit-ci" title="Link to this heading">¶</a></h2>
<section id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h3>
<p>Unlike most parts of the LLVM project, libc++ uses a pre-commit CI <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. This
CI is hosted on <a class="reference external" href="https://buildkite.com/llvm-project/libcxx-ci">Buildkite</a> and
the build results are visible in the review on GitHub. Please make sure
the CI is green before committing a patch.</p>
<p>The CI tests libc++ for all <a class="reference internal" href="index.html#supportedplatforms"><span class="std std-ref">supported platforms</span></a>.
The build is started for every commit added to a Pull Request. A complete CI
run takes approximately one hour. To reduce the load:</p>
<ul class="simple">
<li><p>The build is cancelled when a new commit is pushed to a PR that is already running CI.</p></li>
<li><p>The build is done in several stages and cancelled when a stage fails.</p></li>
</ul>
<p>Typically, the libc++ jobs use a Ubuntu Docker image. This image contains
recent <a class="reference external" href="https://apt.llvm.org">nightly builds</a> of all supported versions of
Clang and the current version of the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch. These versions of Clang
are used to build libc++ and execute its tests.</p>
<p>Unless specified otherwise, the configurations:</p>
<ul class="simple">
<li><p>use a nightly build of the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch of Clang,</p></li>
<li><p>execute the tests using the language C++&lt;latest&gt;. This is the version
“developed” by the C++ committee.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Updating the Clang nightly builds in the Docker image is a manual
process and is done at an irregular interval on purpose. When you need to
have the latest nightly build to test recent Clang changes, ask in the
<code class="docutils literal notranslate"><span class="pre">#libcxx</span></code> channel on <a class="reference external" href="https://discord.gg/jzUbyP26tQ">LLVM’s Discord server</a>.</p>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>There’s <a class="reference external" href="https://www.youtube.com/watch?v=B7gB6van7Bw">LLVM Dev Meeting talk</a>
explaining the benefits of libc++’s pre-commit CI.</p>
</aside>
</aside>
</section>
<section id="builds">
<h3>Builds<a class="headerlink" href="#builds" title="Link to this heading">¶</a></h3>
<p>Below is a short description of the most interesting CI builds <a class="footnote-reference brackets" href="#id5" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Format</span></code> runs <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> and uploads its output as an artifact. At the
moment this build is a soft error and doesn’t fail the build.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Generated</span> <span class="pre">output</span></code> runs the <code class="docutils literal notranslate"><span class="pre">libcxx-generate-files</span></code> build target and
tests for non-ASCII characters in libcxx. Some files are excluded since they
use Unicode, mainly tests. The output of these commands are uploaded as
artifact.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Documentation</span></code> builds the documentation. (This is done early in the build
process since it is cheap to run.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C++&lt;version&gt;</span></code> these build steps test the various C++ versions, making sure all
C++ language versions work with the changes made.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Clang</span> <span class="pre">&lt;version&gt;</span></code> these build steps test whether the changes work with all
supported Clang versions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Booststrapping</span> <span class="pre">build</span></code> builds Clang using the revision of the patch and
uses that Clang version to build and test libc++. This validates the current
Clang and lib++ are compatible.</p>
<p>When a crash occurs in this build, the crash reproducer is available as an
artifact.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Modular</span> <span class="pre">build</span></code> tests libc++ using Clang modules <a class="footnote-reference brackets" href="#id6" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GCC</span> <span class="pre">&lt;version&gt;</span></code> tests libc++ with the latest stable GCC version. Only C++11
and the latest C++ version are tested.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Santitizers</span></code> tests libc++ using the Clang sanitizers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Parts</span> <span class="pre">disabled</span></code> tests libc++ with certain libc++ features disabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Windows</span></code> tests libc++ using MinGW and clang-cl.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Apple</span></code> tests libc++ on MacOS.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ARM</span></code> tests libc++ on various Linux ARM platforms.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AIX</span></code> tests libc++ on AIX.</p></li>
</ul>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>Not all steps are listed: steps are added and removed when the need arises.</p>
</aside>
<aside class="footnote brackets" id="id6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p>Clang modules are not the same as C++20’s modules.</p>
</aside>
</aside>
</section>
<section id="infrastructure">
<h3>Infrastructure<a class="headerlink" href="#infrastructure" title="Link to this heading">¶</a></h3>
<p>All files of the CI infrastructure are in the directory <code class="docutils literal notranslate"><span class="pre">libcxx/utils/ci</span></code>.
Note that quite a bit of this infrastructure is heavily Linux focused. This is
the platform used by most of libc++’s Buildkite runners and developers.</p>
<section id="dockerfile">
<h4>Dockerfile<a class="headerlink" href="#dockerfile" title="Link to this heading">¶</a></h4>
<p>Contains the Docker image for the Ubuntu CI. Because the same Docker image is
used for the <code class="docutils literal notranslate"><span class="pre">main</span></code> and <code class="docutils literal notranslate"><span class="pre">release</span></code> branch, it should contain no hard-coded
versions.  It contains the used versions of Clang, various clang-tools,
GCC, and CMake.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This image is pulled from Docker hub and not rebuild when changing
the Dockerfile.</p>
</div>
</section>
<section id="run-buildbot-container">
<h4>run-buildbot-container<a class="headerlink" href="#run-buildbot-container" title="Link to this heading">¶</a></h4>
<p>Helper script that pulls and runs the Docker image. This image mounts the LLVM
monorepo at <code class="docutils literal notranslate"><span class="pre">/llvm</span></code>. This can be used to test with compilers not available on
your system.</p>
</section>
<section id="run-buildbot">
<h4>run-buildbot<a class="headerlink" href="#run-buildbot" title="Link to this heading">¶</a></h4>
<p>Contains the build script executed on Buildkite. This script can be executed
locally or inside <code class="docutils literal notranslate"><span class="pre">run-buildbot-container</span></code>. The script must be called with
the target to test. For example, <code class="docutils literal notranslate"><span class="pre">run-buildbot</span> <span class="pre">generic-cxx20</span></code> will build
libc++ and test it using C++20.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This script will overwrite the directory <code class="docutils literal notranslate"><span class="pre">&lt;llvm-root&gt;/build/XX</span></code>
where <code class="docutils literal notranslate"><span class="pre">XX</span></code> is the target of <code class="docutils literal notranslate"><span class="pre">run-buildbot</span></code>.</p>
</div>
<p>This script contains as little version information as possible. This makes it
easy to use the script with a different compiler. This allows testing a
combination not in the libc++ CI. It can be used to add a new (temporary)
job to the CI. For example, testing the C++17 build with Clang-14 can be done
like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>clang-14<span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>clang++-14<span class="w"> </span>run-buildbot<span class="w"> </span>generic-cxx17
</pre></div>
</div>
</section>
<section id="buildkite-pipeline-yml">
<h4>buildkite-pipeline.yml<a class="headerlink" href="#buildkite-pipeline-yml" title="Link to this heading">¶</a></h4>
<p>Contains the jobs executed in the CI. This file contains the version
information of the jobs being executed. Since this script differs between the
<code class="docutils literal notranslate"><span class="pre">main</span></code> and <code class="docutils literal notranslate"><span class="pre">release</span></code> branch, both branches can use different compiler
versions.</p>
</section>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="ABIGuarantees.html">libc++’s ABI Guarantees</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="CodingGuidelines.html">libc++ Coding Guidelines</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2011-2025, LLVM Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>