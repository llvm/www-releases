<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Getting Started &#8212; The Flang Compiler</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=e491ac2d" />
    <script src="_static/documentation_options.js?v=1d8edcb3"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How to implement a Sematic Check in Flang" href="ImplementingASemanticCheck.html" />
    <link rel="prev" title="Getting Involved" href="GettingInvolved.html" />
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
</style>

  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>The Flang Compiler</span></a></h1>
        <h2 class="heading"><span>Getting Started</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="GettingInvolved.html">Getting Involved</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="ImplementingASemanticCheck.html">How to implement a Sematic Check in Flang</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <!--===- docs/GettingStarted.md

   Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
   See https://llvm.org/LICENSE.txt for license information.
   SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

-->
<section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#building-flang" id="id1">Building flang</a></p>
<ul>
<li><p><a class="reference internal" href="#building-flang-in-tree-with-bootstrapped-flang-rt" id="id2">Building flang in tree with bootstrapped Flang-RT</a></p></li>
<li><p><a class="reference internal" href="#building-flang-standalone" id="id3">Building flang standalone</a></p></li>
<li><p><a class="reference internal" href="#building-flang-rt-for-accelerators" id="id4">Building Flang-RT for accelerators</a></p>
<ul>
<li><p><a class="reference internal" href="#building-out-of-tree" id="id5">Building out-of-tree</a></p>
<ul>
<li><p><a class="reference internal" href="#cuda-build" id="id6">CUDA build</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-in-tree-bootstrapping-build" id="id7">Building in-tree (bootstrapping build)</a></p>
<ul>
<li><p><a class="reference internal" href="#openmp-target-offload-build" id="id8">OpenMP target offload build</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#build-options" id="id9">Build options</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#supported-c-compilers" id="id10">Supported C++ compilers</a></p>
<ul>
<li><p><a class="reference internal" href="#building-flang-with-gcc" id="id11">Building flang with GCC</a></p></li>
<li><p><a class="reference internal" href="#building-flang-with-clang" id="id12">Building flang with clang</a></p></li>
<li><p><a class="reference internal" href="#installation-directory" id="id13">Installation Directory</a></p></li>
<li><p><a class="reference internal" href="#build-types" id="id14">Build Types</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-run-tests" id="id15">How to Run Tests</a></p>
<ul>
<li><p><a class="reference internal" href="#for-standalone-builds" id="id16">For standalone builds</a></p></li>
<li><p><a class="reference internal" href="#for-in-tree-builds" id="id17">For in tree builds</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-generate-documentation" id="id18">How to Generate Documentation</a></p>
<ul>
<li><p><a class="reference internal" href="#generate-fir-documentation" id="id19">Generate FIR Documentation</a></p></li>
<li><p><a class="reference internal" href="#generate-doxygen-based-documentation" id="id20">Generate Doxygen-based Documentation</a></p></li>
<li><p><a class="reference internal" href="#generate-sphinx-based-documentation" id="id21">Generate Sphinx-based Documentation</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="building-flang">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Building flang</a><a class="headerlink" href="#building-flang" title="Link to this heading">¶</a></h2>
<p>There are two ways to build flang. The first method is to build it at the same
time that you build all of the projects on which it depends. This is called
building in tree. The second method is to first do an in tree build to create
all of the projects on which flang depends.  Then, after creating this base
build, only build the flang code itself. This is called building standalone.
Building standalone has the advantage of being smaller and faster. Once you
create the base build and base install areas, you can create multiple
standalone builds using them.</p>
<p>Note that instructions for building LLVM can be found at
https://llvm.org/docs/GettingStarted.html.</p>
<p>All of the examples below use GCC as the C/C++ compilers and ninja as the build
tool.</p>
<section id="building-flang-in-tree-with-bootstrapped-flang-rt">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Building flang in tree with bootstrapped Flang-RT</a><a class="headerlink" href="#building-flang-in-tree-with-bootstrapped-flang-rt" title="Link to this heading">¶</a></h3>
<p>Building flang in tree means building flang along with all of the projects on
which it depends.  These projects include mlir, clang, flang, openmp, and
compiler-rt.  Note that compiler-rt is only needed to access libraries that
support 16 bit floating point numbers.  It’s not needed to run the automated
tests.  You can use several different C++ compilers for most of the build,
includig GNU and clang.  But building compiler-rt requres using the clang
compiler built in the initial part of the build.</p>
<p>Here’s a directory structure that works.  Create a root directory for the
cloned and built files.  Under that root directory, clone the source code
into a directory called llvm-project.  The build will also
create subdirectories under the root directory called build (holds most of
the built files), install (holds the installed files, and compiler-rt (holds
the result of building compiler-rt).</p>
<p>Here’s a complete set of commands to clone all of the necessary source and do
the build.</p>
<p>First, create the root directory and <code class="docutils literal notranslate"><span class="pre">cd</span></code> into it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>root
<span class="nb">cd</span><span class="w"> </span>root
</pre></div>
</div>
<p>Now clone the source:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/llvm/llvm-project.git
</pre></div>
</div>
<p>Once the clone is complete, execute the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-rf<span class="w"> </span>build
mkdir<span class="w"> </span>build
rm<span class="w"> </span>-rf<span class="w"> </span>install
mkdir<span class="w"> </span>install
<span class="nv">ROOTDIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nv">INSTALLDIR</span><span class="o">=</span><span class="nv">$ROOTDIR</span>/install

<span class="nb">cd</span><span class="w"> </span>build

cmake<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-G<span class="w"> </span>Ninja<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$INSTALLDIR</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_STANDARD<span class="o">=</span><span class="m">17</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_EXPORT_COMPILE_COMMANDS<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_LINK_FLAGS<span class="o">=</span><span class="s2">&quot;-Wl,-rpath,</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DFLANG_ENABLE_WERROR<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_ASSERTIONS<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_TARGETS_TO_BUILD<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_LIT_ARGS<span class="o">=</span>-v<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span><span class="s2">&quot;clang;mlir;flang;openmp&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;compiler-rt;flang-rt&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>../llvm-project/llvm

ninja
</pre></div>
</div>
<p>On Darwin, to make flang able to link binaries with the default sysroot without
having to specify additional flags, use the <code class="docutils literal notranslate"><span class="pre">DEFAULT_SYSROOT</span></code> CMake flag, e.g.
<code class="docutils literal notranslate"><span class="pre">-DDEFAULT_SYSROOT=&quot;$(xcrun</span> <span class="pre">--show-sdk-path)&quot;</span></code>.</p>
<p>By default flang tests that do not specify an explicit <code class="docutils literal notranslate"><span class="pre">--target</span></code> flag use
LLVM’s default target triple. For these tests, if there is a need to test on a
different triple by overriding the default, the following needs to be added to
the cmake command above:
<code class="docutils literal notranslate"><span class="pre">-DLLVM_TARGET_TRIPLE_ENV=&quot;&lt;some</span> <span class="pre">string&gt;&quot;</span> <span class="pre">-DFLANG_TEST_TARGET_TRIPLE=&quot;&lt;your</span> <span class="pre">triple&gt;&quot;</span></code>.</p>
<p>To run the flang tests on this build, execute the command in the “build”
directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja<span class="w"> </span>check-flang<span class="w"> </span>check-flang-rt
</pre></div>
</div>
<p>To create the installed files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja<span class="w"> </span>install

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;latest&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$INSTALLDIR</span>/bin/versionrc
</pre></div>
</div>
<p>Note that these instructions specify flang as one of the projects to build in
the in tree build.  This is not strictly necessary for subsequent standalone
builds, but doing so lets you run the flang tests to verify that the source
code is in good shape.</p>
</section>
<section id="building-flang-standalone">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Building flang standalone</a><a class="headerlink" href="#building-flang-standalone" title="Link to this heading">¶</a></h3>
<p>To do the standalone build, start by building flang in tree as described above.
This build can be used as the  base build for several subsequent standalone
builds.  Set the environment variable <strong>ROOT_DIR</strong> to the directory that
contains the subdirectory <code class="docutils literal notranslate"><span class="pre">build</span></code> that was created previously, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">ROOTDIR</span><span class="o">=</span>/home/user/root
</pre></div>
</div>
<p>Start each standalone build the same way by cloning the source for
llvm-project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>standalone
<span class="nb">cd</span><span class="w"> </span>standalone
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/llvm/llvm-project.git
</pre></div>
</div>
<p>Once the clone is complete, execute the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>llvm-project/flang
rm<span class="w"> </span>-rf<span class="w"> </span>build
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build

cmake<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-G<span class="w"> </span>Ninja<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_STANDARD<span class="o">=</span><span class="m">17</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_LINK_FLAGS<span class="o">=</span><span class="s2">&quot;-Wl,-rpath,</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_EXPORT_COMPILE_COMMANDS<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DFLANG_ENABLE_WERROR<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_TARGETS_TO_BUILD<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_ASSERTIONS<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_BUILD_MAIN_SRC_DIR<span class="o">=</span><span class="nv">$ROOTDIR</span>/build/lib/cmake/llvm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_EXTERNAL_LIT<span class="o">=</span><span class="nv">$ROOTDIR</span>/build/bin/llvm-lit<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_LIT_ARGS<span class="o">=</span>-v<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_DIR<span class="o">=</span><span class="nv">$ROOTDIR</span>/build/lib/cmake/llvm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCLANG_DIR<span class="o">=</span><span class="nv">$ROOTDIR</span>/build/lib/cmake/clang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DMLIR_DIR<span class="o">=</span><span class="nv">$ROOTDIR</span>/build/lib/cmake/mlir<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>..

ninja
</pre></div>
</div>
<p>To run the flang tests on this build, execute the command in the <code class="docutils literal notranslate"><span class="pre">flang/build</span></code>
directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja<span class="w"> </span>check-flang
</pre></div>
</div>
<p>To build Flang-RT (required for linking executables):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$ROOTDIR</span>
rm<span class="w"> </span>-rf<span class="w"> </span>flang-rt
mkdir<span class="w"> </span>flang-rt
<span class="nb">cd</span><span class="w"> </span>flang-rt
<span class="nv">CC</span><span class="o">=</span><span class="nv">$INSTALLDIR</span>/bin/clang<span class="w"> </span><span class="se">\</span>
<span class="nv">CXX</span><span class="o">=</span><span class="nv">$INSTALLDIR</span>/bin/clang++<span class="w"> </span><span class="se">\</span>
cmake<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-G<span class="w"> </span>Ninja<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>../llvm-project/runtimes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$INSTALLDIR</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_EXPORT_COMPILE_COMMANDS<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span>flang-rt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_BINARY_DIR<span class="o">=</span><span class="nv">$ROOTDIR</span>/build<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_Fortran_COMPILER<span class="o">=</span><span class="nv">$INSTALLDIR</span>/bin/flang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_Fortran_COMPILER_WORKS<span class="o">=</span>ON

ninja
ninja<span class="w"> </span>check-flang-rt
ninja<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="building-flang-rt-for-accelerators">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Building Flang-RT for accelerators</a><a class="headerlink" href="#building-flang-rt-for-accelerators" title="Link to this heading">¶</a></h3>
<p>Flang runtime can be built for accelerators in experimental mode, i.e.
complete enabling is WIP.  CUDA and OpenMP target offload builds
are currently supported.</p>
<section id="building-out-of-tree">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Building out-of-tree</a><a class="headerlink" href="#building-out-of-tree" title="Link to this heading">¶</a></h4>
<section id="cuda-build">
<h5><a class="toc-backref" href="#id6" role="doc-backlink">CUDA build</a><a class="headerlink" href="#cuda-build" title="Link to this heading">¶</a></h5>
<p>Clang with NVPTX backend and NVCC compilers are supported.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>llvm-project
rm<span class="w"> </span>-rf<span class="w"> </span>build_flang_runtime
mkdir<span class="w"> </span>build_flang_runtime
<span class="nb">cd</span><span class="w"> </span>build_flang_runtime

cmake<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span>flang-rt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DFLANG_RT_EXPERIMENTAL_OFFLOAD_SUPPORT<span class="o">=</span>CUDA<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="m">80</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_HOST_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>../runtimes/
make<span class="w"> </span>flang-rt
</pre></div>
</div>
<p>Note that the used version of <code class="docutils literal notranslate"><span class="pre">clang</span></code> must <a class="reference external" href="https://releases.llvm.org/16.0.0/tools/clang/docs/ReleaseNotes.html#cuda-support">support</a>
CUDA toolkit version installed on the build machine.  If there are multiple
CUDA toolkit installations, please use <code class="docutils literal notranslate"><span class="pre">-DCUDAToolkit_ROOT=/some/path</span></code>
to specify the compatible version.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>llvm-project
rm<span class="w"> </span>-rf<span class="w"> </span>build_flang_runtime
mkdir<span class="w"> </span>build_flang_runtime
<span class="nb">cd</span><span class="w"> </span>build_flang_runtime

cmake<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span>flang-rt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DFLANG_RT_EXPERIMENTAL_OFFLOAD_SUPPORT<span class="o">=</span>CUDA<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="m">80</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_COMPILER<span class="o">=</span>nvcc<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_HOST_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>../runtimes/

make<span class="w"> </span>flang-rt
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">nvcc</span></code> might limit support to certain
<a class="reference external" href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#host-compiler-support-policy">versions</a> of <code class="docutils literal notranslate"><span class="pre">CMAKE_CUDA_HOST_COMPILER</span></code>,
so please use compatible versions.</p>
<p>The result of the build is a “fat” library with the host and device
code.  Note that the packaging of the libraries is different
between <a class="reference external" href="https://clang.llvm.org/docs/OffloadingDesign.html#linking-target-device-code">Clang</a> and NVCC, so the library must be linked using
compatible compiler drivers.</p>
</section>
</section>
<section id="building-in-tree-bootstrapping-build">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Building in-tree (bootstrapping build)</a><a class="headerlink" href="#building-in-tree-bootstrapping-build" title="Link to this heading">¶</a></h4>
<p>One may build Flang runtime library along with building Flang itself
by providing these additional CMake variables on top of the Flang in-tree
build config:</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span>flang-rt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DFLANG_RT_EXPERIMENTAL_OFFLOAD_SUPPORT<span class="o">=</span>CUDA<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="m">80</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_HOST_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>../llvm
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span>flang-rt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DFLANG_RT_EXPERIMENTAL_OFFLOAD_SUPPORT<span class="o">=</span>CUDA<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_ARCHITECTURES<span class="o">=</span><span class="m">80</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_C_COMPILER<span class="o">=</span>gcc<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>g++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_COMPILER<span class="o">=</span>nvcc<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CUDA_HOST_COMPILER<span class="o">=</span>g++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>../llvm
</pre></div>
</div>
<p>Normal <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check-flang</span></code> will work with such CMake configuration.
Consider building in parallel using the <code class="docutils literal notranslate"><span class="pre">-j&lt;jobs&gt;</span></code> flag, where <code class="docutils literal notranslate"><span class="pre">&lt;jobs&gt;</span></code> is a
number sufficiently low for all build jobs to fit into the available RAM. Using
the number of harware threads (<code class="docutils literal notranslate"><span class="pre">nprocs</span></code>) is likely too much for most
commodity machines.</p>
<section id="openmp-target-offload-build">
<h5><a class="toc-backref" href="#id8" role="doc-backlink">OpenMP target offload build</a><a class="headerlink" href="#openmp-target-offload-build" title="Link to this heading">¶</a></h5>
<p>Only Clang compiler is currently supported.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>llvm-project
rm<span class="w"> </span>-rf<span class="w"> </span>build_flang_runtime
mkdir<span class="w"> </span>build_flang_runtime
<span class="nb">cd</span><span class="w"> </span>build_flang_runtime

cmake<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span>flang-rt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DFLANG_RT_EXPERIMENTAL_OFFLOAD_SUPPORT<span class="o">=</span><span class="s2">&quot;OpenMP&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DFLANG_RT_DEVICE_ARCHITECTURES<span class="o">=</span>all<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>../runtimes/

make<span class="w"> </span>flang-rt
</pre></div>
</div>
<p>The result of the build is a “device-only” library, i.e. the host
part of the library is just a container for the device code.
The resulting library may be linked to user programs using
Clang-like device linking pipeline.</p>
<p>The same set of CMake variables works for Flang in-tree build.</p>
</section>
</section>
</section>
<section id="build-options">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Build options</a><a class="headerlink" href="#build-options" title="Link to this heading">¶</a></h3>
<p>One may provide optional CMake variables to customize the build. Available options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-DFLANG_RUNTIME_F128_MATH_LIB=libquadmath</span></code>: enables build of
<code class="docutils literal notranslate"><span class="pre">flang_rt.quadmath</span></code> library that provides <code class="docutils literal notranslate"><span class="pre">REAL(16)</span></code> math APIs
for intrinsics such as <code class="docutils literal notranslate"><span class="pre">SIN</span></code>, <code class="docutils literal notranslate"><span class="pre">COS</span></code>, etc. GCC <code class="docutils literal notranslate"><span class="pre">libquadmath</span></code>’s header file
<code class="docutils literal notranslate"><span class="pre">quadmath.h</span></code> must be available to the build compiler.
<a class="reference internal" href="Real16MathSupport.html"><span class="std std-doc">More details</span></a>.</p></li>
</ul>
</section>
</section>
<section id="supported-c-compilers">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Supported C++ compilers</a><a class="headerlink" href="#supported-c-compilers" title="Link to this heading">¶</a></h2>
<p>Flang is written in C++17.</p>
<p>The code has been compiled and tested with GCC versions from 7.2.0 to 9.3.0.</p>
<p>The code has been compiled and tested with clang version 7.0, 8.0, 9.0 and 10.0
using either GNU’s libstdc++ or LLVM’s libc++.</p>
<p>The code has been compiled on AArch64, x86_64 and ppc64le servers with CentOS7,
Ubuntu18.04, Rhel, MacOs, Mojave, XCode and Apple Clang version 10.0.1.</p>
<p>Note that flang is not supported on 32 bit CPUs.</p>
<section id="building-flang-with-gcc">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Building flang with GCC</a><a class="headerlink" href="#building-flang-with-gcc" title="Link to this heading">¶</a></h3>
<p>By default,
cmake will search for g++ on your PATH.
The g++ version must be one of the supported versions
in order to build flang.</p>
<p>Or, cmake will use the variable CXX to find the C++ compiler. CXX should include
the full path to the compiler or a name that will be found on your PATH, e.g.
g++-8.3, assuming g++-8.3 is on your PATH.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>g++-8.3
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CXX</span><span class="o">=</span>/opt/gcc-8.3/bin/g++-8.3<span class="w"> </span>cmake<span class="w"> </span>...
</pre></div>
</div>
</section>
<section id="building-flang-with-clang">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Building flang with clang</a><a class="headerlink" href="#building-flang-with-clang" title="Link to this heading">¶</a></h3>
<p>To build flang with clang,
cmake needs to know how to find clang++
and the GCC library and tools that were used to build clang++.</p>
<p>CXX should include the full path to clang++
or clang++ should be found on your PATH.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>clang++
</pre></div>
</div>
</section>
<section id="installation-directory">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Installation Directory</a><a class="headerlink" href="#installation-directory" title="Link to this heading">¶</a></h3>
<p>To specify a custom install location,
add
<code class="docutils literal notranslate"><span class="pre">-DCMAKE_INSTALL_PREFIX=&lt;INSTALL_PREFIX&gt;</span></code>
to the cmake command
where <code class="docutils literal notranslate"><span class="pre">&lt;INSTALL_PREFIX&gt;</span></code>
is the path where flang should be installed.</p>
</section>
<section id="build-types">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Build Types</a><a class="headerlink" href="#build-types" title="Link to this heading">¶</a></h3>
<p>To create a debug build,
add
<code class="docutils literal notranslate"><span class="pre">-DCMAKE_BUILD_TYPE=Debug</span></code>
to the cmake command.
Debug builds execute slowly.</p>
<p>To create a release build,
add
<code class="docutils literal notranslate"><span class="pre">-DCMAKE_BUILD_TYPE=Release</span></code>
to the cmake command.
Release builds execute quickly.</p>
</section>
</section>
<section id="how-to-run-tests">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">How to Run Tests</a><a class="headerlink" href="#how-to-run-tests" title="Link to this heading">¶</a></h2>
<p>Flang supports 2 different categories of tests</p>
<ol class="arabic simple">
<li><p>Regression tests (https://www.llvm.org/docs/TestingGuide.html#regression-tests)</p></li>
<li><p>Unit tests (https://www.llvm.org/docs/TestingGuide.html#unit-tests)</p></li>
</ol>
<section id="for-standalone-builds">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">For standalone builds</a><a class="headerlink" href="#for-standalone-builds" title="Link to this heading">¶</a></h3>
<p>To run all tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/flang/build
cmake<span class="w"> </span>-DLLVM_DIR<span class="o">=</span><span class="nv">$LLVM</span><span class="w"> </span>-DMLIR_DIR<span class="o">=</span><span class="nv">$MLIR</span><span class="w"> </span>~/flang/src
ninja<span class="w"> </span>check-all
</pre></div>
</div>
<p>To run individual regression tests llvm-lit needs to know the lit
configuration for flang. The parameters in charge of this are:
flang_site_config and flang_config. And they can be set as shown below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;path-to-llvm-lit&gt;/llvm-lit<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--param<span class="w"> </span><span class="nv">flang_site_config</span><span class="o">=</span>&lt;path-to-flang-build&gt;/test-lit/lit.site.cfg.py<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--param<span class="w"> </span><span class="nv">flang_config</span><span class="o">=</span>&lt;path-to-flang-build&gt;/test-lit/lit.cfg.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>&lt;path-to-fortran-test&gt;
</pre></div>
</div>
<p>Unit tests:</p>
<p>If flang was built with <code class="docutils literal notranslate"><span class="pre">-DFLANG_INCLUDE_TESTS=ON</span></code> (<code class="docutils literal notranslate"><span class="pre">ON</span></code> by default), it is possible to generate unittests.
Note: Unit-tests will be skipped for LLVM install for an standalone build as it does not include googletest related headers and libraries.</p>
<p>There are various ways to run unit-tests.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="mf">1.</span> <span class="n">ninja</span> <span class="n">check</span><span class="o">-</span><span class="n">flang</span><span class="o">-</span><span class="n">unit</span>
<span class="mf">2.</span> <span class="n">ninja</span> <span class="n">check</span><span class="o">-</span><span class="nb">all</span> <span class="ow">or</span> <span class="n">ninja</span> <span class="n">check</span><span class="o">-</span><span class="n">flang</span>
<span class="mf">3.</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">llvm</span><span class="o">-</span><span class="n">lit</span><span class="o">&gt;/</span><span class="n">llvm</span><span class="o">-</span><span class="n">lit</span> \
        <span class="n">test</span><span class="o">/</span><span class="n">Unit</span>
<span class="mf">4.</span> <span class="n">Invoking</span> <span class="n">tests</span> <span class="kn">from</span> <span class="o">&lt;</span><span class="n">standalone</span> <span class="n">flang</span> <span class="n">build</span><span class="o">&gt;/</span><span class="n">unittests</span><span class="o">/&lt;</span><span class="n">respective</span> <span class="n">unit</span> <span class="n">test</span> <span class="n">folder</span><span class="o">&gt;</span>

</pre></div>
</div>
</section>
<section id="for-in-tree-builds">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">For in tree builds</a><a class="headerlink" href="#for-in-tree-builds" title="Link to this heading">¶</a></h3>
<p>If flang was built with <code class="docutils literal notranslate"><span class="pre">-DFLANG_INCLUDE_TESTS=ON</span></code> (<code class="docutils literal notranslate"><span class="pre">ON</span></code> by default), it is possible to
generate unittests.</p>
<p>To run all of the flang unit tests use the <code class="docutils literal notranslate"><span class="pre">check-flang-unit</span></code> target:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja<span class="w"> </span>check-flang-unit
</pre></div>
</div>
<p>To run all of the flang regression tests use the <code class="docutils literal notranslate"><span class="pre">check-flang</span></code> target:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja<span class="w"> </span>check-flang
</pre></div>
</div>
</section>
</section>
<section id="how-to-generate-documentation">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">How to Generate Documentation</a><a class="headerlink" href="#how-to-generate-documentation" title="Link to this heading">¶</a></h2>
<section id="generate-fir-documentation">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Generate FIR Documentation</a><a class="headerlink" href="#generate-fir-documentation" title="Link to this heading">¶</a></h3>
<p>If flang was built with <code class="docutils literal notranslate"><span class="pre">-DLINK_WITH_FIR=ON</span></code> (<code class="docutils literal notranslate"><span class="pre">ON</span></code> by default), it is possible to
generate FIR language documentation by running <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">flang-doc</span></code>. This will
create <code class="docutils literal notranslate"><span class="pre">&lt;build-dir&gt;/tools/flang/docs/Dialect/FIRLangRef.md</span></code> in flang build directory.</p>
</section>
<section id="generate-doxygen-based-documentation">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Generate Doxygen-based Documentation</a><a class="headerlink" href="#generate-doxygen-based-documentation" title="Link to this heading">¶</a></h3>
<p>To generate doxygen-style documentation from source code</p>
<ul class="simple">
<li><p>Pass <code class="docutils literal notranslate"><span class="pre">-DLLVM_ENABLE_DOXYGEN=ON</span> <span class="pre">-DFLANG_INCLUDE_DOCS=ON</span></code> to the cmake command.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/llvm-project/build
cmake<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span><span class="s2">&quot;clang;flang&quot;</span><span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span>-DLLVM_ENABLE_DOXYGEN<span class="o">=</span>ON<span class="w"> </span>-DFLANG_INCLUDE_DOCS<span class="o">=</span>ON<span class="w"> </span>../llvm
ninja<span class="w"> </span>doxygen-flang
</pre></div>
</div>
<p>It will generate html in</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>&lt;build-dir&gt;/tools/flang/docs/doxygen/html<span class="w"> </span><span class="c1"># for flang docs</span>
</pre></div>
</div>
</section>
<section id="generate-sphinx-based-documentation">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Generate Sphinx-based Documentation</a><a class="headerlink" href="#generate-sphinx-based-documentation" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://flang.llvm.org/docs/">Flang documentation</a> should preferably be written in <code class="docutils literal notranslate"><span class="pre">markdown(.md)</span></code> syntax (they can be in <code class="docutils literal notranslate"><span class="pre">reStructuredText(.rst)</span></code> format as well but markdown is recommended in first place), it
is mostly meant to be processed by the Sphinx documentation generation
system to create HTML pages which would be hosted on the webpage of flang and
updated periodically.</p>
<p>If you would like to generate and view the HTML locally:</p>
<ul class="simple">
<li><p>Install <a class="reference external" href="http://sphinx-doc.org/">Sphinx</a>, and the required extensions
using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span> <span class="pre">-r</span> <span class="pre">~/llvm-projects/docs/requirements.txt</span></code></p></li>
<li><p>Pass <code class="docutils literal notranslate"><span class="pre">-DLLVM_ENABLE_SPHINX=ON</span> <span class="pre">-DSPHINX_WARNINGS_AS_ERRORS=OFF</span></code> to the cmake command.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/llvm-project/build
cmake<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span><span class="s2">&quot;clang;flang&quot;</span><span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span>-DLLVM_ENABLE_SPHINX<span class="o">=</span>ON<span class="w"> </span>-DSPHINX_WARNINGS_AS_ERRORS<span class="o">=</span>OFF<span class="w"> </span>../llvm
ninja<span class="w"> </span>docs-flang-html
</pre></div>
</div>
<p>It will generate html in</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">   </span><span class="nv">$BROWSER</span><span class="w"> </span>&lt;build-dir&gt;/tools/flang/docs/html/
</pre></div>
</div>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="GettingInvolved.html">Getting Involved</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="ImplementingASemanticCheck.html">How to implement a Sematic Check in Flang</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2017-2025, The Flang Team.
      Last updated on Aug 26, 2025.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>