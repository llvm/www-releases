
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DTLTO &#8212; LLVM 21.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/llvm-theme.css?v=96924833" />
    <script src="_static/documentation_options.js?v=c54a4614"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FatLTO" href="FatLTO.html" />
    <link rel="prev" title="A guide to Dockerfiles for building LLVM" href="Docker.html" />
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
</style>

  </head><body>
<div class="logo">
  <a href="index.html">
    <img src="_static/logo.png"
         alt="LLVM Logo" width="250" height="88"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="FatLTO.html" title="FatLTO"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Docker.html" title="A guide to Dockerfiles for building LLVM"
             accesskey="P">previous</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="UserGuides.html" accesskey="U">User Guides</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">DTLTO</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

<h3>Documentation</h3>

<ul class="want-points">
    <li><a href="https://llvm.org/docs/GettingStartedTutorials.html">Getting Started/Tutorials</a></li>
    <li><a href="https://llvm.org/docs/UserGuides.html">User Guides</a></li>
    <li><a href="https://llvm.org/docs/Reference.html">Reference</a></li>
</ul>

<h3>Getting Involved</h3>

<ul class="want-points">
    <li><a href="https://llvm.org/docs/Contributing.html">Contributing to LLVM</a></li>
    <li><a href="https://llvm.org/docs/HowToSubmitABug.html">Submitting Bug Reports</a></li>
    <li><a href="https://llvm.org/docs/GettingInvolved.html#mailing-lists">Mailing Lists</a></li>
    <li><a href="https://llvm.org/docs/GettingInvolved.html#discord">Discord</a></li>
    <li><a href="https://llvm.org/docs/GettingInvolved.html#meetups-and-social-events">Meetups and Social Events</a></li>
</ul>

<h3>Additional Links</h3>

<ul class="want-points">
    <li><a href="https://llvm.org/docs/FAQ.html">FAQ</a></li>
    <li><a href="https://llvm.org/docs/Lexicon.html">Glossary</a></li>
    <li><a href="https://llvm.org/pubs">Publications</a></li>
    <li><a href="https://github.com/llvm/llvm-project/">Github Repository</a></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/DTLTO.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="dtlto">
<h1>DTLTO<a class="headerlink" href="#dtlto" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#distributed-thinlto-dtlto" id="id1">Distributed ThinLTO (DTLTO)</a></p>
<ul>
<li><p><a class="reference internal" href="#distributors" id="id2">Distributors</a></p></li>
<li><p><a class="reference internal" href="#json-schema" id="id3">JSON Schema</a></p></li>
<li><p><a class="reference internal" href="#todos" id="id4">TODOs</a></p></li>
<li><p><a class="reference internal" href="#constraints" id="id5">Constraints</a></p></li>
</ul>
</li>
</ul>
</nav>
<div class="toctree-wrapper compound">
</div>
<section id="distributed-thinlto-dtlto">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Distributed ThinLTO (DTLTO)</a><a class="headerlink" href="#distributed-thinlto-dtlto" title="Link to this heading">¶</a></h2>
<p>Distributed ThinLTO (DTLTO) enables the distribution of backend ThinLTO
compilations via external distribution systems, such as Incredibuild, during the
link step.</p>
<p>DTLTO extends the existing ThinLTO distribution support which uses separate
<em>thin-link</em>, <em>backend compilation</em>, and <em>link</em> steps. This method is documented
here:</p>
<blockquote>
<div><p><a class="reference external" href="https://blog.llvm.org/2016/06/thinlto-scalable-and-incremental-lto.html">https://blog.llvm.org/2016/06/thinlto-scalable-and-incremental-lto.html</a></p>
</div></blockquote>
<p>Using the <em>separate thin-link</em> approach requires a build system capable of
handling the dynamic dependencies specified in the individual summary index
files, such as Bazel. DTLTO removes this requirement, allowing it to be used
with any build process that supports in-process ThinLTO.</p>
<p>The following commands show the steps used for the <em>separate thin-link</em>
approach for a basic example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">1. clang -flto=thin -O2 t1.c t2.c -c</span>
<span class="go">2. clang -flto=thin -O2 t1.o t2.o -fuse-ld=lld -Wl,--thinlto-index-only</span>
<span class="go">3. clang -O2 -o t1.native.o t1.o -c -fthinlto-index=t1.o.thinlto.bc</span>
<span class="go">4. clang -O2 -o t2.native.o t2.o -c -fthinlto-index=t2.o.thinlto.bc</span>
<span class="go">5. clang t1.native.o t2.native.o -o a.out -fuse-ld=lld</span>
</pre></div>
</div>
<p>With DTLTO, steps 2-5 are performed internally as part of the link step. The
equivalent DTLTO commands for the above are:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">clang -flto=thin -O2 t1.c t2.c -c</span>
<span class="go">clang -flto=thin -O2 t1.o t2.o -fuse-ld=lld -fthinlto-distributor=&lt;distributor_process&gt;</span>
</pre></div>
</div>
<p>For DTLTO, LLD prepares the following for each ThinLTO backend compilation job:</p>
<ul class="simple">
<li><p>An individual index file and a list of input and output files (corresponds to
step 2 above).</p></li>
<li><p>A Clang command line to perform the ThinLTO backend compilations.</p></li>
</ul>
<p>This information is supplied, via a JSON file, to <code class="docutils literal notranslate"><span class="pre">distributor_process</span></code>, which
executes the backend compilations using a distribution system (corresponds to
steps 3 and 4 above). Upon completion, LLD integrates the compiled native object
files into the link process and completes the link (corresponds to step 5
above).</p>
<p>This design keeps the details of distribution systems out of the LLVM source
code.</p>
<p>An example distributor that performs all work on the local system is included in
the LLVM source tree. To run an example with that distributor, a command line
such as the following can be used:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">clang -flto=thin -fuse-ld=lld -O2 t1.o t2.o -fthinlto-distributor=$(which python3) \</span>
<span class="go">  -Xthinlto-distributor=$LLVMSRC/llvm/utils/dtlto/local.py</span>
</pre></div>
</div>
<section id="distributors">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Distributors</a><a class="headerlink" href="#distributors" title="Link to this heading">¶</a></h3>
<p>Distributors are programs responsible for:</p>
<ol class="arabic simple">
<li><p>Consuming the JSON backend compilations job description file.</p></li>
<li><p>Translating job descriptions into requests for the distribution system.</p></li>
<li><p>Blocking execution until all backend compilations are complete.</p></li>
</ol>
<p>Distributors must return a non-zero exit code on failure. They can be
implemented as platform native executables or in a scripting language, such as
Python.</p>
<p>Clang and LLD provide options to specify a distributor program for managing
backend compilations. Distributor options and backend compilation options can
also be specified. Such options are transparently forwarded.</p>
<p>The backend compilations are currently performed by invoking Clang. For further
details, refer to:</p>
<ul class="simple">
<li><p>Clang documentation: <a class="reference external" href="https://clang.llvm.org/docs/ThinLTO.html">https://clang.llvm.org/docs/ThinLTO.html</a></p></li>
<li><p>LLD documentation: <a class="reference external" href="https://lld.llvm.org/DTLTO.html">https://lld.llvm.org/DTLTO.html</a></p></li>
</ul>
<p>When invoked with a distributor, LLD generates a JSON file describing the
backend compilation jobs and executes the distributor, passing it this file.</p>
</section>
<section id="json-schema">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">JSON Schema</a><a class="headerlink" href="#json-schema" title="Link to this heading">¶</a></h3>
<p>The JSON format is explained by reference to the following example, which
describes the backend compilation of the modules <code class="docutils literal notranslate"><span class="pre">t1.o</span></code> and <code class="docutils literal notranslate"><span class="pre">t2.o</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;common&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;linker_output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dtlto.elf&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/usr/bin/clang&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-O2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-fprofile-sample-use=my.prof&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;my.prof&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;jobs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;t1.o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-fthinlto-index=t1.o.thinlto.bc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;t1.native.o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-fproc-stat-report=t1.stats.txt&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;t1.o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;t1.o.thinlto.bc&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;t1.native.o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;t1.stats.txt&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;t2.o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-fthinlto-index=t2.o.thinlto.bc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;t2.native.o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-fproc-stat-report=t2.stats.txt&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;t2.o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;t2.o.thinlto.bc&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;t2.native.o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;t2.stats.txt&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each entry in the <code class="docutils literal notranslate"><span class="pre">jobs</span></code> array represents a single backend compilation job.
Each job object records its own command-line arguments and input/output files.
Shared arguments and inputs are defined once in the <code class="docutils literal notranslate"><span class="pre">common</span></code> object.</p>
<p>Reserved Entries:</p>
<ul class="simple">
<li><p>The first entry in the <code class="docutils literal notranslate"><span class="pre">common.args</span></code> array specifies the compiler
executable to invoke.</p></li>
<li><p>The first entry in each job’s <code class="docutils literal notranslate"><span class="pre">inputs</span></code> array is the bitcode file for the
module being compiled.</p></li>
<li><p>The second entry in each job’s <code class="docutils literal notranslate"><span class="pre">inputs</span></code> array is the corresponding
individual summary index file.</p></li>
<li><p>The first entry in each job’s <code class="docutils literal notranslate"><span class="pre">outputs</span></code> array is the primary output object
file.</p></li>
</ul>
<p>For the <code class="docutils literal notranslate"><span class="pre">outputs</span></code> array, only the first entry is reserved for the primary
output file; there is no guaranteed order for the remaining entries. The primary
output file is specified in a reserved entry because some distribution systems
rely on this path - for example, to provide a meaningful user label for
compilation jobs. Initially, the DTLTO implementation will not produce more than
one output file. However, in the future, if LTO options are added that imply
additional output files, those files will also be included in this array.</p>
<p>Command-line arguments and input/output files are stored separately to allow
the remote compiler to be changed without updating the distributors, as the
distributors do not need to understand the details of the compiler command
line.</p>
<p>To generate the backend compilation commands, the common and job-specific
arguments are concatenated.</p>
<p>When consuming the example JSON above, a distributor is expected to issue the
following backend compilation commands with maximum parallelism:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/usr/bin/clang -O2 -c -fprofile-sample-use=my.prof t1.o -fthinlto-index=t1.o.thinlto.bc -o t1.native.o \</span>
<span class="go">  -fproc-stat-report=t1.stats.txt</span>

<span class="go">/usr/bin/clang -O2 -c -fprofile-sample-use=my.prof t2.o  -fthinlto-index=t2.o.thinlto.bc -o t2.native.o \</span>
<span class="go">  -fproc-stat-report=t2.stats.txt</span>
</pre></div>
</div>
</section>
<section id="todos">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">TODOs</a><a class="headerlink" href="#todos" title="Link to this heading">¶</a></h3>
<p>The following features are planned for DTLTO but not yet implemented:</p>
<ul class="simple">
<li><p>Support for the ThinLTO in-process cache.</p></li>
<li><p>Support for platforms other than ELF and COFF.</p></li>
<li><p>Support for archives with bitcode members.</p></li>
<li><p>Support for more LTO configurations; only a very limited set of LTO
configurations is supported currently, e.g., support for basic block sections
is not currently available.</p></li>
</ul>
</section>
<section id="constraints">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Constraints</a><a class="headerlink" href="#constraints" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Matching versions of Clang and LLD should be used.</p></li>
<li><p>The distributor used must support the JSON schema generated by the version of
LLD in use.</p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="FatLTO.html" title="FatLTO"
             >next</a> |</li>
        <li class="right" >
          <a href="Docker.html" title="A guide to Dockerfiles for building LLVM"
             >previous</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="UserGuides.html" >User Guides</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">DTLTO</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2003-2025, LLVM Project.
      Last updated on 2025-08-26.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>