
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Clang 15.0.0 Release Notes &#8212; Clang 15.0.0 documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Clang Compiler User’s Manual" href="UsersManual.html" />
    <link rel="prev" title="Using Clang as a Compiler" href="index.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Clang 15.0.0 documentation</span></a></h1>
        <h2 class="heading"><span>Clang 15.0.0 Release Notes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Using Clang as a Compiler</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="UsersManual.html">Clang Compiler User’s Manual</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <div class="section" id="clang-release-releasenotestitle">
<h1>Clang 15.0.0 Release Notes<a class="headerlink" href="#clang-release-releasenotestitle" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id6">Introduction</a></p></li>
<li><p><a class="reference internal" href="#what-s-new-in-clang-release" id="id7">What’s New in Clang 15.0.0?</a></p>
<ul>
<li><p><a class="reference internal" href="#major-new-features" id="id8">Major New Features</a></p></li>
<li><p><a class="reference internal" href="#bug-fixes" id="id9">Bug Fixes</a></p></li>
<li><p><a class="reference internal" href="#non-comprehensive-list-of-changes-in-this-release" id="id10">Non-comprehensive list of changes in this release</a></p></li>
<li><p><a class="reference internal" href="#new-compiler-flags" id="id11">New Compiler Flags</a></p></li>
<li><p><a class="reference internal" href="#deprecated-compiler-flags" id="id12">Deprecated Compiler Flags</a></p></li>
<li><p><a class="reference internal" href="#modified-compiler-flags" id="id13">Modified Compiler Flags</a></p></li>
<li><p><a class="reference internal" href="#removed-compiler-flags" id="id14">Removed Compiler Flags</a></p></li>
<li><p><a class="reference internal" href="#new-pragmas-in-clang" id="id15">New Pragmas in Clang</a></p></li>
<li><p><a class="reference internal" href="#attribute-changes-in-clang" id="id16">Attribute Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#windows-support" id="id17">Windows Support</a></p></li>
<li><p><a class="reference internal" href="#aix-support" id="id18">AIX Support</a></p></li>
<li><p><a class="reference internal" href="#c-language-changes-in-clang" id="id19">C Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#c2x-feature-support" id="id20">C2x Feature Support</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id21">C++ Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#cuda-hip-language-changes-in-clang" id="id22">CUDA/HIP Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#objective-c-language-changes-in-clang" id="id23">Objective-C Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#opencl-c-language-changes-in-clang" id="id24">OpenCL C Language Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#abi-changes-in-clang" id="id25">ABI Changes in Clang</a></p></li>
<li><p><a class="reference internal" href="#openmp-support-in-clang" id="id26">OpenMP Support in Clang</a></p></li>
<li><p><a class="reference internal" href="#cuda-support-in-clang" id="id27">CUDA Support in Clang</a></p></li>
<li><p><a class="reference internal" href="#x86-support-in-clang" id="id28">X86 Support in Clang</a></p></li>
<li><p><a class="reference internal" href="#dwarf-support-in-clang" id="id29">DWARF Support in Clang</a></p></li>
<li><p><a class="reference internal" href="#arm-and-aarch64-support-in-clang" id="id30">Arm and AArch64 Support in Clang</a></p></li>
<li><p><a class="reference internal" href="#floating-point-support-in-clang" id="id31">Floating Point Support in Clang</a></p></li>
<li><p><a class="reference internal" href="#internal-api-changes" id="id32">Internal API Changes</a></p></li>
<li><p><a class="reference internal" href="#build-system-changes" id="id33">Build System Changes</a></p></li>
<li><p><a class="reference internal" href="#ast-matchers" id="id34">AST Matchers</a></p></li>
<li><p><a class="reference internal" href="#clang-format" id="id35">clang-format</a></p></li>
<li><p><a class="reference internal" href="#clang-extdef-mapping" id="id36">clang-extdef-mapping</a></p></li>
<li><p><a class="reference internal" href="#libclang" id="id37">libclang</a></p></li>
<li><p><a class="reference internal" href="#static-analyzer" id="id38">Static Analyzer</a></p></li>
<li><p><a class="reference internal" href="#undefined-behavior-sanitizer-ubsan" id="id39">Undefined Behavior Sanitizer (UBSan)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#core-analysis-improvements" id="id40">Core Analysis Improvements</a></p></li>
<li><p><a class="reference internal" href="#new-issues-found" id="id41">New Issues Found</a></p>
<ul>
<li><p><a class="reference internal" href="#python-binding-changes" id="id42">Python Binding Changes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#significant-known-problems" id="id43">Significant Known Problems</a></p></li>
<li><p><a class="reference internal" href="#additional-information" id="id44">Additional Information</a></p></li>
</ul>
</div>
<p>Written by the <a class="reference external" href="https://llvm.org/">LLVM Team</a></p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id6">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document contains the release notes for the Clang C/C++/Objective-C
frontend, part of the LLVM Compiler Infrastructure, release 15.0.0. Here we
describe the status of Clang in some detail, including major
improvements from the previous release and new feature work. For the
general LLVM release notes, see <a class="reference external" href="https://llvm.org/docs/ReleaseNotes.html">the LLVM
documentation</a>. All LLVM
releases may be downloaded from the <a class="reference external" href="https://llvm.org/releases/">LLVM releases web
site</a>.</p>
<p>For more information about Clang or LLVM, including information about the
latest release, please see the <a class="reference external" href="https://clang.llvm.org">Clang Web Site</a> or the
<a class="reference external" href="https://llvm.org">LLVM Web Site</a>.</p>
<p>Note that if you are reading this file from a Git checkout or the
main Clang web page, this document applies to the <em>next</em> release, not
the current one. To see the release notes for a specific release, please
see the <a class="reference external" href="https://llvm.org/releases/">releases page</a>.</p>
</div>
<div class="section" id="what-s-new-in-clang-release">
<h2><a class="toc-backref" href="#id7">What’s New in Clang 15.0.0?</a><a class="headerlink" href="#what-s-new-in-clang-release" title="Permalink to this headline">¶</a></h2>
<p>Some of the major new features and improvements to Clang are listed
here. Generic improvements to Clang as a whole or to its underlying
infrastructure are described first, followed by language-specific
sections with improvements to Clang’s support for those languages.</p>
<div class="section" id="major-new-features">
<h3><a class="toc-backref" href="#id8">Major New Features</a><a class="headerlink" href="#major-new-features" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Clang now supports the <code class="docutils literal notranslate"><span class="pre">-fzero-call-used-regs</span></code> feature for x86. The purpose
of this feature is to limit Return-Oriented Programming (ROP) exploits and
information leakage. It works by zeroing out a selected class of registers
before function return — e.g., all GPRs that are used within the function.
There is an analogous <code class="docutils literal notranslate"><span class="pre">zero_call_used_regs</span></code> attribute to allow for finer
control of this feature.</p></li>
<li><p>Clang now supports randomizing structure layout in C. This feature is a
compile-time hardening technique, making it more difficult for an attacker to
retrieve data from structures. Specify randomization with the
<code class="docutils literal notranslate"><span class="pre">randomize_layout</span></code> attribute. The corresponding <code class="docutils literal notranslate"><span class="pre">no_randomize_layout</span></code>
attribute can be used to turn the feature off.</p>
<p>A seed value is required to enable randomization, and is deterministic based
on a seed value. Use the <code class="docutils literal notranslate"><span class="pre">-frandomize-layout-seed=</span></code> or
<code class="docutils literal notranslate"><span class="pre">-frandomize-layout-seed-file=</span></code> flags.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Randomizing structure layout is a C-only feature.</p>
</div>
</li>
<li><p>Clang now supports the <code class="docutils literal notranslate"><span class="pre">-fstrict-flex-arrays=&lt;arg&gt;</span></code> option to control which
array bounds lead to flexible array members. The option yields more accurate
<code class="docutils literal notranslate"><span class="pre">__builtin_object_size</span></code> and <code class="docutils literal notranslate"><span class="pre">__builtin_dynamic_object_size</span></code> results in
most cases but may be overly conservative for some legacy code.</p></li>
<li><p>Experimental support for HLSL has been added. The implementation is
incomplete and highly experimental. For more information about the ongoing
work to support HLSL see the <a class="reference external" href="https://clang.llvm.org/docs/HLSLSupport.html">documentation</a>, or the <a class="reference external" href="https://github.com/orgs/llvm/projects/4">GitHub project</a>.</p></li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h3><a class="toc-backref" href="#id9">Bug Fixes</a><a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CXXNewExpr::getArraySize()</span></code> previously returned a <code class="docutils literal notranslate"><span class="pre">llvm::Optional</span></code>
wrapping a <code class="docutils literal notranslate"><span class="pre">nullptr</span></code> when the <code class="docutils literal notranslate"><span class="pre">CXXNewExpr</span></code> did not have an array
size expression. This was fixed and <code class="docutils literal notranslate"><span class="pre">::getArraySize()</span></code> will now always
either return <code class="docutils literal notranslate"><span class="pre">None</span></code> or a <code class="docutils literal notranslate"><span class="pre">llvm::Optional</span></code> wrapping a valid <code class="docutils literal notranslate"><span class="pre">Expr*</span></code>.
This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/53742">Issue 53742</a>.</p></li>
<li><p>We now ignore full expressions when traversing cast subexpressions. This
fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/53044">Issue 53044</a>.</p></li>
<li><p>Allow <code class="docutils literal notranslate"><span class="pre">-Wno-gnu</span></code> to silence GNU extension diagnostics for pointer
arithmetic diagnostics. Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/54444">Issue 54444</a>.</p></li>
<li><p>Placeholder constraints, as in <code class="docutils literal notranslate"><span class="pre">Concept</span> <span class="pre">auto</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">f();</span></code>, were not checked
when modifiers like <code class="docutils literal notranslate"><span class="pre">auto&amp;</span></code> or <code class="docutils literal notranslate"><span class="pre">auto**</span></code> were added. These constraints are
now checked.
This fixes  <a class="reference external" href="https://github.com/llvm/llvm-project/issues/53911">Issue 53911</a>
and  <a class="reference external" href="https://github.com/llvm/llvm-project/issues/54443">Issue 54443</a>.</p></li>
<li><p>Previously invalid member variables with template parameters would crash clang.
Now fixed by setting identifiers for them.
This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/28475">Issue 28475 (PR28101)</a>.</p></li>
<li><p>Now allow the <code class="docutils literal notranslate"><span class="pre">restrict</span></code> and <code class="docutils literal notranslate"><span class="pre">_Atomic</span></code> qualifiers to be used in
conjunction with <code class="docutils literal notranslate"><span class="pre">__auto_type</span></code> to match the behavior in GCC. This fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/53652">Issue 53652</a>.</p></li>
<li><p>No longer crash when specifying a variably-modified parameter type in a
function with the <code class="docutils literal notranslate"><span class="pre">naked</span></code> attribute. This fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/50541">Issue 50541</a>.</p></li>
<li><p>Allow multiple <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">weak</span></code> directives to name the same undeclared (if an
alias, target) identifier instead of only processing one such <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">weak</span></code>
per identifier.
Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/28985">Issue 28985</a>.</p></li>
<li><p>Assignment expressions in C11 and later mode now properly strip the _Atomic
qualifier when determining the type of the assignment expression. Fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/48742">Issue 48742</a>.</p></li>
<li><p>Improved the diagnostic when accessing a member of an atomic structure or
union object in C; was previously an unhelpful error, but now issues a
<code class="docutils literal notranslate"><span class="pre">-Watomic-access</span></code> warning which defaults to an error. Fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/54563">Issue 54563</a>.</p></li>
<li><p>Unevaluated lambdas in dependant contexts no longer result in clang crashing.
This fixes Issues <a class="reference external" href="https://github.com/llvm/llvm-project/issues/50376">50376</a>,
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/51414">51414</a>,
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/51416">51416</a>,
and <a class="reference external" href="https://github.com/llvm/llvm-project/issues/51641">51641</a>.</p></li>
<li><p>The builtin function __builtin_dump_struct would crash clang when the target
struct contains a bitfield. It now correctly handles bitfields.
This fixes Issue <a class="reference external" href="https://github.com/llvm/llvm-project/issues/54462">Issue 54462</a>.</p></li>
<li><p>Statement expressions are now disabled in default arguments in general.
This fixes Issue <a class="reference external" href="https://github.com/llvm/llvm-project/issues/53488">Issue 53488</a>.</p></li>
<li><p>According to <a class="reference external" href="https://wg21.link/cwg1394">CWG 1394</a> and
<a class="reference external" href="https://timsong-cpp.github.io/cppwp/n4868/dcl.fct.def#general-2.sentence-3">C++20 [dcl.fct.def.general]p2</a>,
Clang should not diagnose incomplete types in function definitions if the function body is “= delete;”.
This fixes Issue <a class="reference external" href="https://github.com/llvm/llvm-project/issues/52802">Issue 52802</a>.</p></li>
<li><p>Unknown type attributes with a <code class="docutils literal notranslate"><span class="pre">[[]]</span></code> spelling are no longer diagnosed twice.
This fixes Issue <a class="reference external" href="https://github.com/llvm/llvm-project/issues/54817">Issue 54817</a>.</p></li>
<li><p>Clang should no longer incorrectly diagnose a variable declaration inside of
a lambda expression that shares the name of a variable in a containing
if/while/for/switch init statement as a redeclaration.
This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/54913">Issue 54913</a>.</p></li>
<li><p>Overload resolution for constrained function templates could use the partial
order of constraints to select an overload, even if the parameter types of
the functions were different. It now diagnoses this case correctly as an
ambiguous call and an error. Fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/53640">Issue 53640</a>.</p></li>
<li><p>No longer crash when trying to determine whether the controlling expression
argument to a generic selection expression has side effects in the case where
the expression is result dependent. This fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/50227">Issue 50227</a>.</p></li>
<li><p>Fixed an assertion when constant evaluating an initializer for a GCC/Clang
floating-point vector type when the width of the initialization is exactly
the same as the elements of the vector being initialized.
Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/50216">Issue 50216</a>.</p></li>
<li><p>Fixed a crash when the <code class="docutils literal notranslate"><span class="pre">__bf16</span></code> type is used such that its size or
alignment is calculated on a target which does not support that type. This
fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/50171">Issue 50171</a>.</p></li>
<li><p>Fixed a false positive diagnostic about an unevaluated expression having no
side effects when the expression is of VLA type and is an operand of the
<code class="docutils literal notranslate"><span class="pre">sizeof</span></code> operator. Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/48010">Issue 48010</a>.</p></li>
<li><p>Fixed a false positive diagnostic about scoped enumerations being a C++11
extension in C mode. A scoped enumeration’s enumerators cannot be named in C
because there is no way to fully qualify the enumerator name, so this
“extension” was unintentional and useless. This fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/42372">Issue 42372</a>.</p></li>
<li><p>Clang will now find and emit a call to an allocation function in a
promise_type body for coroutines if there is any allocation function
declaration in the scope of promise_type. Additionally, to implement CWG2585,
a coroutine will no longer generate a call to a global allocation function
with the signature (std::size_t, p0, …, pn).
This fixes Issue <a class="reference external" href="https://github.com/llvm/llvm-project/issues/54881">Issue 54881</a>.</p></li>
<li><p>Implement <a class="reference external" href="https://wg21.link/cwg2394">CWG 2394</a>: Const class members
may be initialized with a defaulted default constructor under the same
conditions it would be allowed for a const object elsewhere.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__has_unique_object_representations</span></code> no longer reports that <code class="docutils literal notranslate"><span class="pre">_BitInt</span></code> types
have unique object representations if they have padding bits.</p></li>
<li><p>Unscoped and scoped enumeration types can no longer be initialized from a
brace-init-list containing a single element of a different scoped enumeration
type.</p></li>
<li><p>Allow use of an elaborated type specifier as a <code class="docutils literal notranslate"><span class="pre">_Generic</span></code> selection
association in C++ mode. This fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/55562">Issue 55562</a>.</p></li>
<li><p>Clang will allow calling a <code class="docutils literal notranslate"><span class="pre">consteval</span></code> function in a default argument. This
fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/48230">Issue 48230</a>.</p></li>
<li><p>Fixed memory leak due to <code class="docutils literal notranslate"><span class="pre">VarTemplateSpecializationDecl</span></code> using
<code class="docutils literal notranslate"><span class="pre">TemplateArgumentListInfo</span></code> instead of <code class="docutils literal notranslate"><span class="pre">ASTTemplateArgumentListInfo</span></code>.</p></li>
<li><p>An initializer for a static variable declaration, which is nested
inside a statement expression in an aggregate initializer, is now
emitted as a dynamic initializer. Previously the variable would
incorrectly be zero-initialized. In contexts where a dynamic
initializer is not allowed this is now diagnosed as an error.</p></li>
<li><p>Clang now correctly emits symbols for implicitly instantiated constexpr
template function. Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/55560">Issue 55560</a>.</p></li>
<li><p>Clang now checks ODR violations when merging concepts from different modules.
Note that this may possibly break existing code, and is done so intentionally.
Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/56310">Issue 56310</a>.</p></li>
<li><p>Clang will now look through type sugar when checking a member function is a
move assignment operator. Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/56456">Issue 56456</a>.</p></li>
<li><p>Fixed a crash when a variable with a bool enum type that has no definition
used in comparison operators. Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/56560">Issue 56560</a>.</p></li>
<li><p>Fix that <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">consteval</span></code> could evaluate to <code class="docutils literal notranslate"><span class="pre">true</span></code> at runtime because it was incorrectly
constant folded. Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/55638">Issue 55638</a>.</p></li>
<li><p>Fixed incompatibility of Clang’s <code class="docutils literal notranslate"><span class="pre">&lt;stdatomic.h&gt;</span></code> with MSVC <code class="docutils literal notranslate"><span class="pre">&lt;atomic&gt;</span></code>.
Fixes <a class="reference external" href="https://github.com/microsoft/STL/issues/2862">MSVC STL Issue 2862</a>.</p></li>
<li><p>Empty enums and enums with a single enumerator with value zero will be
considered to have one positive bit in order to represent the underlying
value. This effects whether we consider the store of the value one to be well
defined.</p></li>
<li><p>An operator introduced to the scope via a <cite>using</cite> statement now correctly references this
statement in clangd (hover over the symbol, jump to definition) as well as in the AST dump.
This also fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/#55095">issue 55095</a> as a
side-effect.</p></li>
</ul>
<div class="section" id="improvements-to-clang-s-diagnostics">
<h4>Improvements to Clang’s diagnostics<a class="headerlink" href="#improvements-to-clang-s-diagnostics" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-Wliteral-range</span></code> will warn on floating-point equality comparisons with
constants that are not representable in a casted value. For example,
<code class="docutils literal notranslate"><span class="pre">(float)</span> <span class="pre">f</span> <span class="pre">==</span> <span class="pre">0.1</span></code> is always false.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Winline-namespace-reopened-noninline</span></code> now takes into account that the
<code class="docutils literal notranslate"><span class="pre">inline</span></code> keyword must appear on the original but not necessarily all
extension definitions of an inline namespace and therefore points its note
at the original definition. This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/50794">Issue 50794 (PR51452)</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wunused-but-set-variable</span></code> now also warns if the variable is only used
by unary operators.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wunused-variable</span></code> no longer warn for references extending the lifetime
of temporaries with side effects. This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/54489">Issue 54489</a>.</p></li>
<li><p>Modified the behavior of <code class="docutils literal notranslate"><span class="pre">-Wstrict-prototypes</span></code> and added a new, related
diagnostic <code class="docutils literal notranslate"><span class="pre">-Wdeprecated-non-prototype</span></code>. The strict prototypes warning will
now only diagnose deprecated declarations and definitions of functions
without a prototype where the behavior in C2x will remain correct. This
diagnostic remains off by default but is now enabled via <code class="docutils literal notranslate"><span class="pre">-pedantic</span></code> due to
it being a deprecation warning. <code class="docutils literal notranslate"><span class="pre">-Wstrict-prototypes</span></code> has no effect in C2x
or when <code class="docutils literal notranslate"><span class="pre">-fno-knr-functions</span></code> is enabled. <code class="docutils literal notranslate"><span class="pre">-Wdeprecated-non-prototype</span></code>
will diagnose cases where the deprecated declarations or definitions of a
function without a prototype will change behavior in C2x. Additionally, it
will diagnose calls which pass arguments to a function without a prototype.
This warning is enabled only when the <code class="docutils literal notranslate"><span class="pre">-Wdeprecated-non-prototype</span></code> option
is enabled at the function declaration site, which allows a developer to
disable the diagnostic for all callers at the point of declaration. This
diagnostic is grouped under the <code class="docutils literal notranslate"><span class="pre">-Wstrict-prototypes</span></code> warning group, but is
enabled by default. <code class="docutils literal notranslate"><span class="pre">-Wdeprecated-non-prototype</span></code> has no effect in C2x or
when <code class="docutils literal notranslate"><span class="pre">-fno-knr-functions</span></code> is enabled.</p></li>
<li><p>Clang now appropriately issues an error in C when a definition of a function
without a prototype and with no arguments is an invalid redeclaration of a
function with a prototype. e.g., <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">f(int);</span> <span class="pre">void</span> <span class="pre">f()</span> <span class="pre">{}</span></code> is now properly
diagnosed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-Wimplicit-function-declaration</span></code> warning diagnostic now defaults to
an error in C99 and later. Prior to C2x, it may be downgraded to a warning
with <code class="docutils literal notranslate"><span class="pre">-Wno-error=implicit-function-declaration</span></code>, or disabled entirely with
<code class="docutils literal notranslate"><span class="pre">-Wno-implicit-function-declaration</span></code>. As of C2x, support for implicit
function declarations has been removed, and the warning options will have no
effect.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-Wimplicit-int</span></code> warning diagnostic now defaults to an error in C99 and
later. Prior to C2x, it may be downgraded to a warning with
<code class="docutils literal notranslate"><span class="pre">-Wno-error=implicit-int</span></code>, or disabled entirely with <code class="docutils literal notranslate"><span class="pre">-Wno-implicit-int</span></code>.
As of C2x, support for implicit int has been removed, and the warning options
will have no effect. Specifying <code class="docutils literal notranslate"><span class="pre">-Wimplicit-int</span></code> in C89 mode will now issue
warnings instead of being a noop.</p></li>
<li><p>No longer issue a “declaration specifiers missing, defaulting to int”
diagnostic in C89 mode because it is not an extension in C89, it was valid
code. The diagnostic has been removed entirely as it did not have a
diagnostic group to disable it, but it can be covered wholly by
<code class="docutils literal notranslate"><span class="pre">-Wimplicit-int</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wmisexpect</span></code> warns when the branch weights collected during profiling
conflict with those added by <code class="docutils literal notranslate"><span class="pre">llvm.expect</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wthread-safety-analysis</span></code> now considers overloaded compound assignment and
increment/decrement operators as writing to their first argument, thus
requiring an exclusive lock if the argument is guarded.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wenum-conversion</span></code> now warns on converting a signed enum of one type to an
unsigned enum of a different type (or vice versa) rather than
<code class="docutils literal notranslate"><span class="pre">-Wsign-conversion</span></code>.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">-Wunreachable-code-generic-assoc</span></code> diagnostic flag (grouped under
the <code class="docutils literal notranslate"><span class="pre">-Wunreachable-code</span></code> flag) which is enabled by default and warns the
user about <code class="docutils literal notranslate"><span class="pre">_Generic</span></code> selection associations which are unreachable because
the type specified is an array type or a qualified type.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">-Wgnu-line-marker</span></code> diagnostic flag (grouped under the <code class="docutils literal notranslate"><span class="pre">-Wgnu</span></code>
flag) which is a portability warning about use of GNU linemarker preprocessor
directives. Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/55067">Issue 55067</a>.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">#warning</span></code>, <code class="docutils literal notranslate"><span class="pre">#elifdef</span></code> and <code class="docutils literal notranslate"><span class="pre">#elifndef</span></code> that are incompatible with C/C++
standards before C2x/C++2b are now warned via <code class="docutils literal notranslate"><span class="pre">-pedantic</span></code>. Additionally,
on such language mode, <code class="docutils literal notranslate"><span class="pre">-Wpre-c2x-compat</span></code> and <code class="docutils literal notranslate"><span class="pre">-Wpre-c++2b-compat</span></code>
diagnostic flags report a compatibility issue.
Fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/55306">Issue 55306</a>.</p></li>
<li><p>Clang now checks for stack resource exhaustion when recursively parsing
declarators in order to give a diagnostic before we run out of stack space.
This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/51642">Issue 51642</a>.</p></li>
<li><p>Unknown preprocessor directives in a skipped conditional block are now given
a typo correction suggestion if the given directive is sufficiently similar
to another preprocessor conditional directive. For example, if <code class="docutils literal notranslate"><span class="pre">#esle</span></code>
appears in a skipped block, we will warn about the unknown directive and
suggest <code class="docutils literal notranslate"><span class="pre">#else</span></code> as an alternative. <code class="docutils literal notranslate"><span class="pre">#elifdef</span></code> and <code class="docutils literal notranslate"><span class="pre">#elifndef</span></code> are only
suggested when in C2x or C++2b mode. Fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/51598">Issue 51598</a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-Wdeprecated</span></code> diagnostic will now warn on out-of-line <code class="docutils literal notranslate"><span class="pre">constexpr</span></code>
declarations downgraded to definitions in C++1z, in addition to the
existing warning on out-of-line <code class="docutils literal notranslate"><span class="pre">const</span></code> declarations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wshift-overflow</span></code> will not warn for signed left shifts in C++20 mode
(and newer), as it will always wrap and never overflow. This fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/52873">Issue 52873</a>.</p></li>
<li><p>When using class templates without arguments, clang now tells developers
that template arguments are missing in certain contexts.
This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/55962">Issue 55962</a>.</p></li>
<li><p>Printable Unicode characters within <cite>static_assert</cite> messages are no longer
escaped.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-Winfinite-recursion</span></code> diagnostic no longer warns about
unevaluated operands of a <code class="docutils literal notranslate"><span class="pre">typeid</span></code> expression, as they are now
modeled correctly in the CFG. This fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/21668">Issue 21668</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Wself-assign</span></code>, <code class="docutils literal notranslate"><span class="pre">-Wself-assign-overloaded</span></code> and <code class="docutils literal notranslate"><span class="pre">-Wself-move</span></code> will
suggest a fix if the decl being assigned is a parameter that shadows a data
member of the contained class.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">-Winvalid-utf8</span></code> which diagnoses invalid UTF-8 code unit sequences in
comments.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-Wint-conversion</span></code> warning diagnostic for implicit int &lt;-&gt; pointer
conversions now defaults to an error in all C language modes. It may be
downgraded to a warning with <code class="docutils literal notranslate"><span class="pre">-Wno-error=int-conversion</span></code>, or disabled
entirely with <code class="docutils literal notranslate"><span class="pre">-Wno-int-conversion</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="non-comprehensive-list-of-changes-in-this-release">
<h3><a class="toc-backref" href="#id10">Non-comprehensive list of changes in this release</a><a class="headerlink" href="#non-comprehensive-list-of-changes-in-this-release" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Improve __builtin_dump_struct:</p>
<ul>
<li><p>Support bitfields in struct and union.</p></li>
<li><p>Improve the dump format, dump both bitwidth(if its a bitfield) and field
value.</p></li>
<li><p>Remove anonymous tag locations and flatten anonymous struct members.</p></li>
<li><p>Beautify dump format, add indent for struct members.</p></li>
<li><p>Support passing additional arguments to the formatting function, allowing
use with <code class="docutils literal notranslate"><span class="pre">fprintf</span></code> and similar formatting functions.</p></li>
<li><p>Support use within constant evaluation in C++, if a <code class="docutils literal notranslate"><span class="pre">constexpr</span></code>
formatting function is provided.</p></li>
<li><p>Support formatting of base classes in C++.</p></li>
<li><p>Support calling a formatting function template in C++, which can provide
custom formatting for non-aggregate types.</p></li>
</ul>
</li>
<li><p>Previously disabled sanitizer options now enabled by default:
- ASAN_OPTIONS=detect_stack_use_after_return=1 (only on Linux).
- MSAN_OPTIONS=poison_in_dtor=1.</p></li>
<li><p>Some type-trait builtins, such as <code class="docutils literal notranslate"><span class="pre">__has_trivial_assign</span></code>, have been documented
as deprecated for a while because their semantics don’t mix well with post-C++11 type-traits.
Clang now emits deprecation warnings for them under the flag <code class="docutils literal notranslate"><span class="pre">-Wdeprecated-builtins</span></code>.</p></li>
</ul>
</div>
<div class="section" id="new-compiler-flags">
<h3><a class="toc-backref" href="#id11">New Compiler Flags</a><a class="headerlink" href="#new-compiler-flags" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">-fno-knr-functions</span></code> flag to allow users to opt into the C2x
behavior where a function with an empty parameter list is treated as though
the parameter list were <code class="docutils literal notranslate"><span class="pre">void</span></code>. There is no <code class="docutils literal notranslate"><span class="pre">-fknr-functions</span></code> or
<code class="docutils literal notranslate"><span class="pre">-fno-no-knr-functions</span></code> flag; this feature cannot be disabled in language
modes where it is required, such as C++ or C2x.</p></li>
<li><p>A new ARM pass to workaround Cortex-A57 Erratum 1742098 and Cortex-A72 Erratum
1655431 can be enabled using <code class="docutils literal notranslate"><span class="pre">-mfix-cortex-a57-aes-1742098</span></code> or
<code class="docutils literal notranslate"><span class="pre">-mfix-cortex-a72-aes-1655431</span></code>. The pass is enabled when using either of
these cpus with <code class="docutils literal notranslate"><span class="pre">-mcpu=</span></code> and can be disabled using
<code class="docutils literal notranslate"><span class="pre">-mno-fix-cortex-a57-aes-1742098</span></code> or <code class="docutils literal notranslate"><span class="pre">-mno-fix-cortex-a72-aes-1655431</span></code>.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">-fexperimental-max-bitint-width=</span></code> option to increase the maximum
allowed bit width of <code class="docutils literal notranslate"><span class="pre">_BitInt</span></code> types beyond the default of 128 bits. Some
operations, such as division or float-to-integer conversion, on <code class="docutils literal notranslate"><span class="pre">_BitInt</span></code>
types with more than 128 bits currently crash clang. This option will be
removed in the future once clang supports all such operations.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">-print-diagnostic-options</span></code> option, which prints a list of
warnings the compiler supports.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">-Warray-parameter</span></code> warning. It diagnoses differences between
array parameters between function redeclarations (arrays of different extents,
etc). This flag is related to the same flag in GCC, but is different in that
it does not accept an explicitly- specified warning level and use of this flag
has no effect on <code class="docutils literal notranslate"><span class="pre">-Warray-bounds</span></code>.</p></li>
</ul>
</div>
<div class="section" id="deprecated-compiler-flags">
<h3><a class="toc-backref" href="#id12">Deprecated Compiler Flags</a><a class="headerlink" href="#deprecated-compiler-flags" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="modified-compiler-flags">
<h3><a class="toc-backref" href="#id13">Modified Compiler Flags</a><a class="headerlink" href="#modified-compiler-flags" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="removed-compiler-flags">
<h3><a class="toc-backref" href="#id14">Removed Compiler Flags</a><a class="headerlink" href="#removed-compiler-flags" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Removed the <code class="docutils literal notranslate"><span class="pre">-fno-concept-satisfaction-caching</span></code> flag. The flag was added
at the time when the draft of C++20 standard did not permit caching of
atomic constraints. The final standard permits such caching, see
<a class="reference external" href="http://wg21.link/p2104r0">WG21 P2104R0</a>.</p></li>
</ul>
</div>
<div class="section" id="new-pragmas-in-clang">
<h3><a class="toc-backref" href="#id15">New Pragmas in Clang</a><a class="headerlink" href="#new-pragmas-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added support for MSVC’s <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">function</span></code>, which tells the compiler to
generate calls to functions listed in the pragma instead of using the
builtins.</p></li>
<li><p>Added support for MSVC’s <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">alloc_text</span></code>. The pragma names the code
section functions are placed in. The pragma only applies to functions with
C linkage.</p></li>
<li><p>Added support for an empty optimization list for MSVC’s <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">optimize</span></code>.
The pragma takes a list of optimizations to turn on or off which applies to
all functions following the pragma. At the moment, only an empty list is
supported.</p></li>
<li><p>…</p></li>
</ul>
</div>
<div class="section" id="attribute-changes-in-clang">
<h3><a class="toc-backref" href="#id16">Attribute Changes in Clang</a><a class="headerlink" href="#attribute-changes-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added support for parameter pack expansion in <code class="docutils literal notranslate"><span class="pre">clang::annotate</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">overloadable</span></code> attribute can now be written in all of the syntactic
locations a declaration attribute may appear.
This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/53805">Issue 53805</a>.</p></li>
<li><p>Improved namespace attributes handling:</p>
<ul>
<li><p>Handle GNU attributes before a namespace identifier and subsequent
attributes of different kinds.</p></li>
<li><p>Emit error on GNU attributes for a nested namespace definition.</p></li>
</ul>
</li>
<li><p>Statement attributes <code class="docutils literal notranslate"><span class="pre">[[clang::noinline]]</span></code> and  <code class="docutils literal notranslate"><span class="pre">[[clang::always_inline]]</span></code>
can be used to control inlining decisions at callsites.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">clang</span> <span class="pre">attribute</span> <span class="pre">push</span></code> now supports multiple attributes within a single directive.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">__declspec(naked)</span></code> attribute can no longer be written on a member
function in Microsoft compatibility mode, matching the behavior of cl.exe.</p></li>
<li><p>Attribute <code class="docutils literal notranslate"><span class="pre">no_builtin</span></code> should now affect the generated code. It now disables
builtins (corresponding to the specific names listed in the attribute) in the
body of the function the attribute is on.</p></li>
<li><p>When the <code class="docutils literal notranslate"><span class="pre">weak</span></code> attribute is applied to a const qualified variable clang no longer
tells the backend it is allowed to optimize based on initializer value.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">clang::annotate_type</span></code> attribute, which can be used to add
annotations to types (see documentation for details).</p></li>
<li><p>Added half float to types that can be represented by <code class="docutils literal notranslate"><span class="pre">__attribute__((mode(XX)))</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">format</span></code> attribute can now be applied to non-variadic functions. The
format string must correctly format the fixed parameter types of the function.
Using the attribute this way emits a GCC compatibility diagnostic.</p></li>
<li><p>Support was added for <code class="docutils literal notranslate"><span class="pre">__attribute__((function_return(&quot;thunk-extern&quot;)))</span></code>
to X86 to replace <code class="docutils literal notranslate"><span class="pre">ret</span></code> instructions with <code class="docutils literal notranslate"><span class="pre">jmp</span> <span class="pre">__x86_return_thunk</span></code>. The
corresponding attribute to disable this,
<code class="docutils literal notranslate"><span class="pre">__attribute__((function_return(&quot;keep&quot;)))</span></code> was added. This is intended to
be used by the Linux kernel to mitigate RETBLEED.</p></li>
<li><p>Ignore the <cite>__preferred_name__</cite> attribute when writing for C++20 module interfaces.
This is a short-term workaround intentionally since clang doesn’t take care of the
serialization and deserialization of <cite>__preferred_name__</cite>.  See
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/56490">https://github.com/llvm/llvm-project/issues/56490</a> for example.</p></li>
</ul>
</div>
<div class="section" id="windows-support">
<h3><a class="toc-backref" href="#id17">Windows Support</a><a class="headerlink" href="#windows-support" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Add support for MSVC-compatible <code class="docutils literal notranslate"><span class="pre">/JMC</span></code>/<code class="docutils literal notranslate"><span class="pre">/JMC-</span></code> flag in clang-cl (supports
X86/X64/ARM/ARM64). <code class="docutils literal notranslate"><span class="pre">/JMC</span></code> could only be used when <code class="docutils literal notranslate"><span class="pre">/Zi</span></code> or <code class="docutils literal notranslate"><span class="pre">/Z7</span></code> is
turned on. With this addition, clang-cl can be used in Visual Studio for the
JustMyCode feature. Note, you may need to manually add <code class="docutils literal notranslate"><span class="pre">/JMC</span></code> as additional
compile options in the Visual Studio since it currently assumes clang-cl does not support <code class="docutils literal notranslate"><span class="pre">/JMC</span></code>.</p></li>
<li><p>Implemented generation of SEH unwind information on ARM. (C++ exception
handling in MSVC mode is still unimplemented though.)</p></li>
<li><p>Switched MinGW mode on ARM to use SEH instead of DWARF for unwind information.</p></li>
</ul>
</div>
<div class="section" id="aix-support">
<h3><a class="toc-backref" href="#id18">AIX Support</a><a class="headerlink" href="#aix-support" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The driver no longer adds <code class="docutils literal notranslate"><span class="pre">-mignore-xcoff-visibility</span></code> by default for AIX
targets when no other visibility command-line options are in effect, as
ignoring hidden visibility can silently have undesirable side effects (e.g
when libraries depend on visibility to hide non-ABI facing entities). The
<code class="docutils literal notranslate"><span class="pre">-mignore-xcoff-visibility</span></code> option can be manually specified on the
command-line to recover the previous behavior if desired.</p></li>
</ul>
</div>
<div class="section" id="c-language-changes-in-clang">
<h3><a class="toc-backref" href="#id19">C Language Changes in Clang</a><a class="headerlink" href="#c-language-changes-in-clang" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="c2x-feature-support">
<h3><a class="toc-backref" href="#id20">C2x Feature Support</a><a class="headerlink" href="#c2x-feature-support" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Implemented <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2764.pdf">WG14 N2674 The noreturn attribute</a>.</p></li>
<li><p>Implemented <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2935.pdf">WG14 N2935 Make false and true first-class language features</a>.</p></li>
<li><p>Implemented <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2763.pdf">WG14 N2763 Adding a fundamental type for N-bit integers</a>.</p></li>
<li><p>Implemented <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2775.pdf">WG14 N2775 Literal suffixes for bit-precise integers</a>.</p></li>
<li><p>Implemented the <code class="docutils literal notranslate"><span class="pre">*_WIDTH</span></code> macros to complete support for
<a class="reference external" href="https://www9.open-std.org/jtc1/sc22/wg14/www/docs/n2412.pdf">WG14 N2412 Two’s complement sign representation for C2x</a>.</p></li>
<li><p>Implemented <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2418.pdf">WG14 N2418 Adding the u8 character prefix</a>.</p></li>
<li><p>Removed support for implicit function declarations. This was a C89 feature
that was removed in C99, but cannot be supported in C2x because it requires
support for functions without prototypes, which no longer exist in C2x.</p></li>
<li><p>Implemented <a class="reference external" href="https://www9.open-std.org/jtc1/sc22/wg14/www/docs/n2841.htm">WG14 N2841 No function declarators without prototypes</a>
and <a class="reference external" href="https://www9.open-std.org/jtc1/sc22/wg14/www/docs/n2432.pdf">WG14 N2432 Remove support for function definitions with identifier lists</a>.</p></li>
<li><p>Implemented <a class="reference external" href="https://www.open-std.org/jtc1/sc22/wg14/www/docs/n2836.pdf">WG14 N2836 Identifier Syntax using Unicode Standard Annex 31</a>.</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id21">C++ Language Changes in Clang</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Improved <code class="docutils literal notranslate"><span class="pre">-O0</span></code> code generation for calls to <code class="docutils literal notranslate"><span class="pre">std::move</span></code>, <code class="docutils literal notranslate"><span class="pre">std::forward</span></code>,
<code class="docutils literal notranslate"><span class="pre">std::move_if_noexcept</span></code>, <code class="docutils literal notranslate"><span class="pre">std::addressof</span></code>, and <code class="docutils literal notranslate"><span class="pre">std::as_const</span></code>. These
are now treated as compiler builtins and implemented directly, rather than
instantiating the definition from the standard library.</p></li>
<li><p>Fixed mangling of nested dependent names such as <code class="docutils literal notranslate"><span class="pre">T::a::b</span></code>, where <code class="docutils literal notranslate"><span class="pre">T</span></code> is a
template parameter, to conform to the Itanium C++ ABI and be compatible with
GCC. This breaks binary compatibility with code compiled with earlier versions
of clang; use the <code class="docutils literal notranslate"><span class="pre">-fclang-abi-compat=14</span></code> option to get the old mangling.</p></li>
<li><p>Preprocessor character literals with a <code class="docutils literal notranslate"><span class="pre">u8</span></code> prefix are now correctly treated as
unsigned character literals. This fixes <a class="reference external" href="https://github.com/llvm/llvm-project/issues/54886">Issue 54886</a>.</p></li>
<li><p>Stopped allowing constraints on non-template functions to be compliant with
dcl.decl.general p4.</p></li>
<li><p>Improved <code class="docutils literal notranslate"><span class="pre">copy</span> <span class="pre">elision</span></code> optimization. It’s possible to apply <code class="docutils literal notranslate"><span class="pre">NRVO</span></code> for an object if at the moment when
any return statement of this object is executed, the <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">slot</span></code> won’t be occupied by another object.</p></li>
</ul>
<div class="section" id="c-20-feature-support">
<h4>C++20 Feature Support<a class="headerlink" href="#c-20-feature-support" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Diagnose consteval and constexpr issues that happen at namespace scope. This
partially addresses <a class="reference external" href="https://github.com/llvm/llvm-project/issues/51593">Issue 51593</a>.</p></li>
<li><p>No longer attempt to evaluate a consteval UDL function call at runtime when
it is called through a template instantiation. This fixes
<a class="reference external" href="https://github.com/llvm/llvm-project/issues/54578">Issue 54578</a>.</p></li>
<li><p>Implemented <code class="docutils literal notranslate"><span class="pre">__builtin_source_location()</span></code>, which enables library support
for <code class="docutils literal notranslate"><span class="pre">std::source_location</span></code>.</p></li>
<li><p>The mangling scheme for C++20 modules has incompatibly changed. The
initial mangling was discovered not to be reversible, and the weak
ownership design decision did not give the backwards compatibility
that was hoped for. C++20 since added <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C++&quot;</span></code> semantics
that can be used for such compatibility. The demangler now demangles
symbols with named module attachment.</p></li>
<li><p>Enhanced the support for C++20 Modules, including: Partitions,
Reachability, Header Unit and <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C++&quot;</span></code> semantics.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/P1103R3">P1103R3: Merging Modules</a>.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/P1779R3">P1779R3: ABI isolation for member functions</a>.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/P1874R1">P1874R1: Dynamic Initialization Order of Non-Local Variables in Modules</a>.</p></li>
<li><p>Partially implemented <a class="reference external" href="https://wg21.link/P1815R2">P1815R2: Translation-unit-local entities</a>.</p></li>
<li><p>As per “Conditionally Trivial Special Member Functions” (P0848), it is
now possible to overload destructors using concepts. Note that the rest
of the paper about other special member functions is not yet implemented.</p></li>
</ul>
</div>
<div class="section" id="c-2b-feature-support">
<h4>C++2b Feature Support<a class="headerlink" href="#c-2b-feature-support" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Implemented <a class="reference external" href="https://wg21.link/P2128R6">P2128R6: Multidimensional subscript operator</a>.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/P0849R8">P0849R8: auto(x): decay-copy in the language</a>.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/P2242R3">P2242R3: Non-literal variables (and labels and gotos) in constexpr functions</a>.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/LWG3659">LWG3659: Consider ATOMIC_FLAG_INIT undeprecation</a>.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/P2290R3">P2290R3 Delimited escape sequences</a>.
This feature is available as an extension in all C and C++ language modes.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/P2290R2">P2071R2 Named universal character escapes</a>.
This feature is available as an extension in all C and C++ language modes.</p></li>
<li><p>Implemented <a class="reference external" href="https://wg21.link/P2327R1">P2327R1 De-deprecating volatile compound operations</a></p></li>
</ul>
</div>
</div>
<div class="section" id="cuda-hip-language-changes-in-clang">
<h3><a class="toc-backref" href="#id22">CUDA/HIP Language Changes in Clang</a><a class="headerlink" href="#cuda-hip-language-changes-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added <cite>__noinline__</cite> as a keyword to avoid diagnostics due to usage of
<cite>__attribute__((__noinline__))</cite> in CUDA/HIP programs.</p></li>
</ul>
</div>
<div class="section" id="objective-c-language-changes-in-clang">
<h3><a class="toc-backref" href="#id23">Objective-C Language Changes in Clang</a><a class="headerlink" href="#objective-c-language-changes-in-clang" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="opencl-c-language-changes-in-clang">
<h3><a class="toc-backref" href="#id24">OpenCL C Language Changes in Clang</a><a class="headerlink" href="#opencl-c-language-changes-in-clang" title="Permalink to this headline">¶</a></h3>
<p>…</p>
</div>
<div class="section" id="abi-changes-in-clang">
<h3><a class="toc-backref" href="#id25">ABI Changes in Clang</a><a class="headerlink" href="#abi-changes-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>GCC doesn’t pack non-POD members in packed structs unless the packed
attribute is also specified on the member. Clang historically did perform
such packing. Clang now matches the gcc behavior (except on Darwin and PS4).
You can switch back to the old ABI behavior with the flag:
<code class="docutils literal notranslate"><span class="pre">-fclang-abi-compat=14.0</span></code>.</p></li>
<li><p>When compiling C for ARM or AArch64, a zero-length bitfield in a <code class="docutils literal notranslate"><span class="pre">struct</span></code>
(e.g. <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">:</span> <span class="pre">0</span></code>) no longer prevents the structure from being considered a
homogeneous floating-point or vector aggregate. The new behavior agrees with
the AAPCS specification, and matches the similar bug fix in GCC 12.1.</p></li>
<li><p>Targeting AArch64, since D127209 LLVM now only preserves the z8-z23
and p4-p15 registers across a call if the registers z0-z7 or p0-p3 are
used to pass data into or out of a subroutine. The new behavior
matches the AAPCS. Previously LLVM preserved z8-z23 and p4-p15 across
a call if the callee had an SVE type anywhere in its signature. This
would cause an incorrect use of the caller-preserved z8-z23 and p4-p15
ABI for example if the 9th argument or greater were the first SVE type
in the signature of a function.</p></li>
<li><p>All copy constructors can now be trivial if they are not user-provided,
regardless of the type qualifiers of the argument of the defaulted constructor,
fixing dr2171.
You can switch back to the old ABI behavior with the flag:
<code class="docutils literal notranslate"><span class="pre">-fclang-abi-compat=14.0</span></code>.</p></li>
</ul>
</div>
<div class="section" id="openmp-support-in-clang">
<h3><a class="toc-backref" href="#id26">OpenMP Support in Clang</a><a class="headerlink" href="#openmp-support-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added the support for <code class="docutils literal notranslate"><span class="pre">atomic</span> <span class="pre">compare</span></code> and <code class="docutils literal notranslate"><span class="pre">atomic</span> <span class="pre">compare</span> <span class="pre">capture</span></code>
(<code class="docutils literal notranslate"><span class="pre">-fopenmp-version=51</span></code> is required).</p></li>
</ul>
<p>…</p>
</div>
<div class="section" id="cuda-support-in-clang">
<h3><a class="toc-backref" href="#id27">CUDA Support in Clang</a><a class="headerlink" href="#cuda-support-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>…</p></li>
</ul>
</div>
<div class="section" id="x86-support-in-clang">
<h3><a class="toc-backref" href="#id28">X86 Support in Clang</a><a class="headerlink" href="#x86-support-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Support <code class="docutils literal notranslate"><span class="pre">-mharden-sls=[none|all|return|indirect-jmp]</span></code> for straight-line
speculation hardening.</p></li>
<li><p>Support for the <code class="docutils literal notranslate"><span class="pre">_Float16</span></code> type has been added for all targets with SSE2.
When AVX512-FP16 is not available, arithmetic on <code class="docutils literal notranslate"><span class="pre">_Float16</span></code> is emulated
using <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">-m[no-]rdpru</span></code> flag to enable/disable the RDPRU instruction
provided by AMD Zen2 and later processors. Defined intrinsics for using
this instruction (see rdpruintrin.h).</p></li>
<li><p>Support <code class="docutils literal notranslate"><span class="pre">-mstack-protector-guard-symbol=[SymbolName]</span></code> to use the given
symbol for addressing the stack protector guard.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-mfunction-return=thunk-extern</span></code> support was added to clang for x86. This
will be used by Linux kernel mitigations for RETBLEED. The corresponding flag
<code class="docutils literal notranslate"><span class="pre">-mfunction-return=keep</span></code> may be appended to disable the feature.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">_Float16</span></code> type requires SSE2 feature and above due to the instruction
limitations. When using it on i386 targets, you need to specify <code class="docutils literal notranslate"><span class="pre">-msse2</span></code>
explicitly.</p>
<p>For targets without F16C feature or above, please make sure:</p>
<ul class="simple">
<li><p>Use GCC 12.0 and above if you are using libgcc.</p></li>
<li><p>If you are using compiler-rt, use the same version with the compiler.</p></li>
</ul>
<p>Early versions provided FP16 builtins in a different ABI. A workaround is to use
a small code snippet to check the ABI if you cannot make sure of it.
- If you are using downstream runtimes that provide FP16 conversions, update
them with the new ABI.</p>
</div>
<div class="section" id="dwarf-support-in-clang">
<h3><a class="toc-backref" href="#id29">DWARF Support in Clang</a><a class="headerlink" href="#dwarf-support-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>clang now adds DWARF information for inline strings in C/C++ programs,
allowing <code class="docutils literal notranslate"><span class="pre">line:column</span></code> symbolization of strings. Some debugging programs may
require updating, as this takes advantage of DWARF <code class="docutils literal notranslate"><span class="pre">DW_TAG_variable</span></code>
structures <em>without</em> a <code class="docutils literal notranslate"><span class="pre">DW_AT_name</span></code> field, which is valid DWARF, but may be
handled incorrectly by some software (e.g. new failures with incorrect
assertions).</p></li>
</ul>
</div>
<div class="section" id="arm-and-aarch64-support-in-clang">
<h3><a class="toc-backref" href="#id30">Arm and AArch64 Support in Clang</a><a class="headerlink" href="#arm-and-aarch64-support-in-clang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>clang now supports the Cortex-M85 CPU, which can be chosen with
<cite>-mcpu=cortex-m85</cite>. By default, this has PACBTI turned on, but it can be
disabled with <cite>-mcpu=cortex-m85+nopacbti</cite>.</p></li>
</ul>
</div>
<div class="section" id="floating-point-support-in-clang">
<h3><a class="toc-backref" href="#id31">Floating Point Support in Clang</a><a class="headerlink" href="#floating-point-support-in-clang" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="internal-api-changes">
<h3><a class="toc-backref" href="#id32">Internal API Changes</a><a class="headerlink" href="#internal-api-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added a new attribute flag <code class="docutils literal notranslate"><span class="pre">AcceptsExprPack</span></code> that when set allows
expression pack expansions in the parsed arguments of the corresponding
attribute. Additionally it introduces delaying of attribute arguments, adding
common handling for creating attributes that cannot be fully initialized
prior to template instantiation.</p></li>
</ul>
</div>
<div class="section" id="build-system-changes">
<h3><a class="toc-backref" href="#id33">Build System Changes</a><a class="headerlink" href="#build-system-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>CMake <code class="docutils literal notranslate"><span class="pre">-DCLANG_DEFAULT_PIE_ON_LINUX=ON</span></code> is now the default. This is used by
linux-gnu systems to decide whether <code class="docutils literal notranslate"><span class="pre">-fPIE</span> <span class="pre">-pie</span></code> is the default (instead of
<code class="docutils literal notranslate"><span class="pre">-fno-pic</span> <span class="pre">-no-pie</span></code>). This matches GCC installations on many Linux distros.
Note: linux-android and linux-musl always default to <code class="docutils literal notranslate"><span class="pre">-fPIE</span> <span class="pre">-pie</span></code>, ignoring
this variable. <code class="docutils literal notranslate"><span class="pre">-DCLANG_DEFAULT_PIE_ON_LINUX</span></code> may be removed in the future.</p></li>
</ul>
</div>
<div class="section" id="ast-matchers">
<h3><a class="toc-backref" href="#id34">AST Matchers</a><a class="headerlink" href="#ast-matchers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Expanded <code class="docutils literal notranslate"><span class="pre">isInline</span></code> narrowing matcher to support C++17 inline variables.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">forEachTemplateArgument</span></code> matcher which creates a match every
time a <code class="docutils literal notranslate"><span class="pre">templateArgument</span></code> matches the matcher supplied to it.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">objcStringLiteral</span></code> matcher which matches ObjectiveC String
literal expressions.</p></li>
</ul>
</div>
<div class="section" id="clang-format">
<h3><a class="toc-backref" href="#id35">clang-format</a><a class="headerlink" href="#clang-format" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Important change</strong>: Renamed <code class="docutils literal notranslate"><span class="pre">IndentRequires</span></code> to <code class="docutils literal notranslate"><span class="pre">IndentRequiresClause</span></code>
and changed the default for all styles from <code class="docutils literal notranslate"><span class="pre">false</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p>Reworked and improved handling of concepts and requires. Added the
<code class="docutils literal notranslate"><span class="pre">RequiresClausePosition</span></code> option as part of that.</p></li>
<li><p>Changed <code class="docutils literal notranslate"><span class="pre">BreakBeforeConceptDeclarations</span></code> from <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> to an enum.</p></li>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">InsertBraces</span></code> has been added to insert optional braces after control
statements.</p></li>
</ul>
</div>
<div class="section" id="clang-extdef-mapping">
<h3><a class="toc-backref" href="#id36">clang-extdef-mapping</a><a class="headerlink" href="#clang-extdef-mapping" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>clang-extdef-mapping now accepts .ast files as input. This is faster than to
recompile the files from sources when extracting method definitons. This can
be really beneficial when creating .ast files for input to the clang-static-analyzer.</p></li>
</ul>
</div>
<div class="section" id="libclang">
<h3><a class="toc-backref" href="#id37">libclang</a><a class="headerlink" href="#libclang" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The soversion for libclang will now change for each new LLVM major release.  This matches
the behavior of clang &lt;= 13.</p></li>
</ul>
</div>
<div class="section" id="static-analyzer">
<h3><a class="toc-backref" href="#id38">Static Analyzer</a><a class="headerlink" href="#static-analyzer" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://discourse.llvm.org/t/rfc-much-faster-cross-translation-unit-ctu-analysis-implementation/61728">New CTU implementation</a>
that keeps the slow-down around 2x compared to the single-TU analysis, even
in case of complex C++ projects. Still, it finds the majority of the “old”
CTU findings. Besides, not more than ~3% of the bug reports are lost compared
to single-TU analysis, the lost reports are highly likely to be false
positives.</p></li>
<li><p>Added a new checker <code class="docutils literal notranslate"><span class="pre">alpha.unix.cstring.UninitializedRead</span></code> this will check for uninitialized reads
from common memory copy/manipulation functions such as <code class="docutils literal notranslate"><span class="pre">memcpy</span></code>, <code class="docutils literal notranslate"><span class="pre">mempcpy</span></code>, <code class="docutils literal notranslate"><span class="pre">memmove</span></code>, <code class="docutils literal notranslate"><span class="pre">memcmp</span></code>, `
<cite>strcmp`</cite>, <code class="docutils literal notranslate"><span class="pre">strncmp</span></code>, <code class="docutils literal notranslate"><span class="pre">strcpy</span></code>, <code class="docutils literal notranslate"><span class="pre">strlen</span></code>, <code class="docutils literal notranslate"><span class="pre">strsep</span></code> and many more. Although
this checker currently is in list of alpha checkers due to a false positive.</p></li>
<li><p>Added a new checker <code class="docutils literal notranslate"><span class="pre">alpha.unix.Errno</span></code>. This can find the first read
of <code class="docutils literal notranslate"><span class="pre">errno</span></code> after successful standard function calls, such use of <code class="docutils literal notranslate"><span class="pre">errno</span></code>
could be unsafe.</p></li>
<li><p>Deprecate the <code class="docutils literal notranslate"><span class="pre">-analyzer-store</span> <span class="pre">region</span></code> and
<code class="docutils literal notranslate"><span class="pre">-analyzer-opt-analyze-nested-blocks</span></code> analyzer flags.
These flags are still accepted, but a warning will be displayed.
These flags will be rejected, thus turned into a hard error starting with
<code class="docutils literal notranslate"><span class="pre">clang-16</span></code>.</p></li>
</ul>
</div>
<div class="section" id="undefined-behavior-sanitizer-ubsan">
<span id="release-notes-ubsan"></span><h3><a class="toc-backref" href="#id39">Undefined Behavior Sanitizer (UBSan)</a><a class="headerlink" href="#undefined-behavior-sanitizer-ubsan" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="core-analysis-improvements">
<h2><a class="toc-backref" href="#id40">Core Analysis Improvements</a><a class="headerlink" href="#core-analysis-improvements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>…</p></li>
</ul>
</div>
<div class="section" id="new-issues-found">
<h2><a class="toc-backref" href="#id41">New Issues Found</a><a class="headerlink" href="#new-issues-found" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>…</p></li>
</ul>
<div class="section" id="python-binding-changes">
<h3><a class="toc-backref" href="#id42">Python Binding Changes</a><a class="headerlink" href="#python-binding-changes" title="Permalink to this headline">¶</a></h3>
<p>The following methods have been added:</p>
<ul class="simple">
<li><p>…</p></li>
</ul>
</div>
</div>
<div class="section" id="significant-known-problems">
<h2><a class="toc-backref" href="#id43">Significant Known Problems</a><a class="headerlink" href="#significant-known-problems" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="additional-information">
<h2><a class="toc-backref" href="#id44">Additional Information</a><a class="headerlink" href="#additional-information" title="Permalink to this headline">¶</a></h2>
<p>A wide variety of additional information is available on the <a class="reference external" href="https://clang.llvm.org/">Clang web
page</a>. The web page contains versions of the
API documentation which are up-to-date with the Git version of
the source code. You can access versions of these documents specific to
this release by going into the “<code class="docutils literal notranslate"><span class="pre">clang/docs/</span></code>” directory in the Clang
tree.</p>
<p>If you have any questions or comments about Clang, please feel free to
contact us on the Discourse forums (Clang Frontend category)
&lt;<a class="reference external" href="https://discourse.llvm.org/c/clang/6">https://discourse.llvm.org/c/clang/6</a>&gt;`_.</p>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Using Clang as a Compiler</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="UsersManual.html">Clang Compiler User’s Manual</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2007-2022, The Clang Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.2.
    </div>
  </body>
</html>