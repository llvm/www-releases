<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Vendor Documentation &#8212; libc++  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=e491ac2d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing to libc++" href="Contributing.html" />
    <link rel="prev" title="User documentation" href="UserDocumentation.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>libc++  documentation</span></a></h1>
        <h2 class="heading"><span>Vendor Documentation</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="UserDocumentation.html">User documentation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="Contributing.html">Contributing to libc++</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="vendor-documentation">
<span id="vendordocumentation"></span><h1>Vendor Documentation<a class="headerlink" href="#vendor-documentation" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#the-default-build" id="id2">The default build</a></p>
<ul>
<li><p><a class="reference internal" href="#using-the-just-built-libc" id="id3">Using the just-built libc++</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-bootstrapping-build" id="id4">The Bootstrapping build</a></p></li>
<li><p><a class="reference internal" href="#vendor-configuration-options" id="id5">Vendor Configuration Options</a></p>
<ul>
<li><p><a class="reference internal" href="#general-purpose-options" id="id6">General purpose options</a></p></li>
<li><p><a class="reference internal" href="#abi-specific-options" id="id7">ABI Specific Options</a></p></li>
<li><p><a class="reference internal" href="#llvm-specific-options" id="id8">LLVM-specific options</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#support-for-windows" id="id9">Support for Windows</a></p>
<ul>
<li><p><a class="reference internal" href="#cmake-visual-studio" id="id10">CMake + Visual Studio</a></p></li>
<li><p><a class="reference internal" href="#cmake-ninja-msvc" id="id11">CMake + ninja (MSVC)</a></p></li>
<li><p><a class="reference internal" href="#cmake-ninja-mingw" id="id12">CMake + ninja (MinGW)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#overriding-the-default-assertion-handler" id="id13">Overriding the default assertion handler</a></p></li>
<li><p><a class="reference internal" href="#using-alternate-abi-libraries" id="id14">Using Alternate ABI libraries</a></p>
<ul>
<li><p><a class="reference internal" href="#using-libsupc-on-linux" id="id15">Using libsupc++ on Linux</a></p></li>
<li><p><a class="reference internal" href="#using-libcxxrt-on-linux" id="id16">Using libcxxrt on Linux</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>The instructions on this page are aimed at vendors who ship libc++ as part of an
operating system distribution, a toolchain or similar shipping vehicles. If you
are a user merely trying to use libc++ in your program, you most likely want to
refer to your vendor’s documentation, or to the general user documentation
<a class="reference internal" href="UserDocumentation.html#user-documentation"><span class="std std-ref">here</span></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If your operating system already provides libc++, it is important to be careful
not to replace it. Replacing your system’s libc++ installation could render it
non-functional. Use the CMake option <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> to select a safe
place to install libc++.</p>
</div>
<section id="the-default-build">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">The default build</a><a class="headerlink" href="#the-default-build" title="Link to this heading">¶</a></h2>
<p>The default way of building libc++, libc++abi and libunwind is to root the CMake
invocation at <code class="docutils literal notranslate"><span class="pre">&lt;monorepo&gt;/runtimes</span></code>. While those projects are under the LLVM
umbrella, they are different in nature from other build tools, so it makes sense
to treat them as a separate set of entities. The default build can be achieved
with the following CMake invocation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/llvm/llvm-project.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>llvm-project
$<span class="w"> </span>mkdir<span class="w"> </span>build
$<span class="w"> </span>cmake<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-S<span class="w"> </span>runtimes<span class="w"> </span>-B<span class="w"> </span>build<span class="w"> </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libcxx;libcxxabi;libunwind&quot;</span><span class="w"> </span><span class="c1"># Configure</span>
$<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>cxx<span class="w"> </span>cxxabi<span class="w"> </span>unwind<span class="w">                                                        </span><span class="c1"># Build</span>
$<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>check-cxx<span class="w"> </span>check-cxxabi<span class="w"> </span>check-unwind<span class="w">                                      </span><span class="c1"># Test</span>
$<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>install-cxx<span class="w"> </span>install-cxxabi<span class="w"> </span>install-unwind<span class="w">                                </span><span class="c1"># Install</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="#vendor-configuration-options"><span class="std std-ref">Vendor Configuration Options</span></a> below for more configuration options.</p>
</div>
<p>After building the various <code class="docutils literal notranslate"><span class="pre">install-XXX</span></code> targets, shared libraries for libc++, libc++abi and
libunwind should now be present in <code class="docutils literal notranslate"><span class="pre">&lt;CMAKE_INSTALL_PREFIX&gt;/lib</span></code>, and headers in
<code class="docutils literal notranslate"><span class="pre">&lt;CMAKE_INSTALL_PREFIX&gt;/include/c++/v1</span></code>. See the instructions below for information on how
to use this libc++ over the default one.</p>
<p>In the default configuration, the runtimes will be built using the compiler available by default
on your system. Of course, you can change what compiler is being used with the usual CMake
variables. If you wish to build the runtimes from a just-built Clang, the bootstrapping build
explained below makes this task easy.</p>
<section id="using-the-just-built-libc">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Using the just-built libc++</a><a class="headerlink" href="#using-the-just-built-libc" title="Link to this heading">¶</a></h3>
<p>Most compilers provide a way to disable the default behavior for finding the standard library and
to override it with custom paths. With Clang, this can be done with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang++<span class="w"> </span>-nostdinc++<span class="w"> </span>-isystem<span class="w"> </span>&lt;install&gt;/include/c++/v1<span class="w"> </span><span class="se">\</span>
<span class="w">          </span>-nostdlib++<span class="w"> </span>-L<span class="w"> </span>&lt;install&gt;/lib<span class="w"> </span>-lc++<span class="w">            </span><span class="se">\</span>
<span class="w">          </span>-Wl,-rpath,&lt;install&gt;/lib<span class="w">                      </span><span class="se">\</span>
<span class="w">          </span>test.cpp
</pre></div>
</div>
<p>The option <code class="docutils literal notranslate"><span class="pre">-Wl,-rpath,&lt;install&gt;/lib</span></code> adds a runtime library search path, which causes the system’s
dynamic linker to look for libc++ in <code class="docutils literal notranslate"><span class="pre">&lt;install&gt;/lib</span></code> whenever the program is loaded.</p>
</section>
</section>
<section id="the-bootstrapping-build">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">The Bootstrapping build</a><a class="headerlink" href="#the-bootstrapping-build" title="Link to this heading">¶</a></h2>
<p>It is possible to build Clang and then build the runtimes using that just-built compiler in a
single CMake invocation. This is usually the correct way to build the runtimes when putting together
a toolchain, or when the system compiler is not adequate to build them (too old, unsupported, etc.).
To do this, use the following CMake invocation, and in particular notice how we’re now rooting the
CMake invocation at <code class="docutils literal notranslate"><span class="pre">&lt;monorepo&gt;/llvm</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkdir<span class="w"> </span>build
$<span class="w"> </span>cmake<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-S<span class="w"> </span>llvm<span class="w"> </span>-B<span class="w"> </span>build<span class="w"> </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span><span class="s2">&quot;clang&quot;</span><span class="w">                      </span><span class="se">\ </span><span class="w"> </span><span class="c1"># Configure</span>
<span class="w">                                  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libcxx;libcxxabi;libunwind&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">                                  </span>-DLLVM_RUNTIME_TARGETS<span class="o">=</span><span class="s2">&quot;&lt;target-triple&gt;&quot;</span>
$<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>runtimes<span class="w">                                                                </span><span class="c1"># Build</span>
$<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>check-runtimes<span class="w">                                                          </span><span class="c1"># Test</span>
$<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>install-runtimes<span class="w">                                                        </span><span class="c1"># Install</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This type of build is also commonly called a “Runtimes build”, but we would like to move
away from that terminology, which is too confusing.</p></li>
<li><p>Adding the <cite>–fresh</cite> flag to the top-level cmake invocation in a bootstrapping build <em>will not</em>
freshen the cmake cache of any of the enabled runtimes.</p></li>
</ul>
</div>
</section>
<section id="vendor-configuration-options">
<span id="id1"></span><h2><a class="toc-backref" href="#id5" role="doc-backlink">Vendor Configuration Options</a><a class="headerlink" href="#vendor-configuration-options" title="Link to this heading">¶</a></h2>
<p>This section documents configuration options that can be used by vendors when building the library.
These options provide a great deal of flexibility to customize libc++, such as selecting the ABI in
use, whether some features are provided, etc.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Many of these CMake options are tied to configuration macros with a corresponding name in the source
code. However, these configuration macros are not intended to be customized by users directly, since
many of them require the library to be built with a matching configuration. If you don’t build libc++
yourself, you should not use the options documented here.</p>
</div>
<section id="general-purpose-options">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">General purpose options</a><a class="headerlink" href="#general-purpose-options" title="Link to this heading">¶</a></h3>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_INSTALL_LIBRARY-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_INSTALL_LIBRARY:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_INSTALL_LIBRARY-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Toggle the installation of the library portion of libc++.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_INSTALL_HEADERS-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_INSTALL_HEADERS:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_INSTALL_HEADERS-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Toggle the installation of the libc++ headers.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_INSTALL_MODULES-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_INSTALL_MODULES:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_INSTALL_MODULES-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Toggle the installation of the experimental libc++ module sources.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_SHARED-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_SHARED:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_SHARED-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Build libc++ as a shared library. Either <cite>LIBCXX_ENABLE_SHARED</cite> or
<cite>LIBCXX_ENABLE_STATIC</cite> has to be enabled.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_STATIC-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_STATIC:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_STATIC-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Build libc++ as a static library. Either <cite>LIBCXX_ENABLE_SHARED</cite> or
<cite>LIBCXX_ENABLE_STATIC</cite> has to be enabled.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_LIBDIR_SUFFIX-STRING">
<span class="sig-name descname"><span class="pre">LIBCXX_LIBDIR_SUFFIX:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_LIBDIR_SUFFIX-STRING" title="Link to this definition">¶</a></dt>
<dd><p>Extra suffix to append to the directory where libraries are to be installed.
This option overrides <cite>LLVM_LIBDIR_SUFFIX</cite>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_HERMETIC_STATIC_LIBRARY-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_HERMETIC_STATIC_LIBRARY:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_HERMETIC_STATIC_LIBRARY-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">OFF</span></code></p>
<p>Do not export any symbols from the static libc++ library.
This is useful when the static libc++ library is being linked into shared
libraries that may be used in with other shared libraries that use different
C++ library. We want to avoid exporting any libc++ symbols in that case.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_FILESYSTEM-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_FILESYSTEM:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_FILESYSTEM-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code> except on Windows when using MSVC.</p>
<p>This option can be used to enable or disable the filesystem components on
platforms that may not support them. For example on Windows when using MSVC.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_WIDE_CHARACTERS-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_WIDE_CHARACTERS:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_WIDE_CHARACTERS-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>This option can be used to disable support for <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> in the library. It also
allows the library to work on top of a C Standard Library that does not provide
support for <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>. This is especially useful in embedded settings where
C Standard Libraries don’t always provide all the usual bells and whistles.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_TIME_ZONE_DATABASE-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_TIME_ZONE_DATABASE:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_TIME_ZONE_DATABASE-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Whether to include support for time zones in the library. Disabling
time zone support can be useful when porting to platforms that don’t
ship the IANA time zone database. When time zones are not supported,
time zone support in &lt;chrono&gt; will be disabled.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_INSTALL_LIBRARY_DIR-PATH">
<span class="sig-name descname"><span class="pre">LIBCXX_INSTALL_LIBRARY_DIR:PATH</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_INSTALL_LIBRARY_DIR-PATH" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">lib${LIBCXX_LIBDIR_SUFFIX}</span></code></p>
<p>Path where built libc++ libraries should be installed. If a relative path,
relative to <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_INSTALL_INCLUDE_DIR-PATH">
<span class="sig-name descname"><span class="pre">LIBCXX_INSTALL_INCLUDE_DIR:PATH</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_INSTALL_INCLUDE_DIR-PATH" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">include/c++/v1</span></code></p>
<p>Path where target-agnostic libc++ headers should be installed. If a relative
path, relative to <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_INSTALL_INCLUDE_TARGET_DIR-PATH">
<span class="sig-name descname"><span class="pre">LIBCXX_INSTALL_INCLUDE_TARGET_DIR:PATH</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_INSTALL_INCLUDE_TARGET_DIR-PATH" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">include/c++/v1</span></code> or
<code class="docutils literal notranslate"><span class="pre">include/${LLVM_DEFAULT_TARGET_TRIPLE}/c++/v1</span></code></p>
<p>Path where target-specific libc++ headers should be installed. If a relative
path, relative to <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_SHARED_OUTPUT_NAME-STRING">
<span class="sig-name descname"><span class="pre">LIBCXX_SHARED_OUTPUT_NAME:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_SHARED_OUTPUT_NAME-STRING" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">c++</span></code></p>
<p>Output name for the shared libc++ runtime library.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX-LIBCXXABI-LIBUNWIND-_ADDITIONAL_COMPILE_FLAGS-STRING">
<span class="sig-name descname"><span class="pre">{LIBCXX,LIBCXXABI,LIBUNWIND}_ADDITIONAL_COMPILE_FLAGS:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX-LIBCXXABI-LIBUNWIND-_ADDITIONAL_COMPILE_FLAGS-STRING" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p>
<p>Additional compile flags to use when building the runtimes. This should be a CMake <code class="docutils literal notranslate"><span class="pre">;</span></code>-delimited list of individual
compiler options to use. For options that must be passed as-is to the compiler without deduplication (e.g.
<code class="docutils literal notranslate"><span class="pre">-Xclang</span> <span class="pre">-foo</span></code> option groups), consider using <code class="docutils literal notranslate"><span class="pre">SHELL:</span></code> as <a class="reference external" href="https://cmake.org/cmake/help/latest/command/add_compile_options.html#option-de-duplication">documented here</a>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ADDITIONAL_LIBRARIES-STRING">
<span class="sig-name descname"><span class="pre">LIBCXX_ADDITIONAL_LIBRARIES:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ADDITIONAL_LIBRARIES-STRING" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p>
<p>Additional libraries libc++ is linked to which can be provided in cache.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_EXCEPTIONS-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_EXCEPTIONS:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_EXCEPTIONS-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Build libc++ with exception support.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_RTTI-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_RTTI:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_RTTI-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Build libc++ with run time type information.
This option may only be set to OFF when LIBCXX_ENABLE_EXCEPTIONS=OFF.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_INCLUDE_TESTS-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_INCLUDE_TESTS:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_INCLUDE_TESTS-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code> (or value of <code class="docutils literal notranslate"><span class="pre">LLVM_INCLUDE_TESTS</span></code>)</p>
<p>Build the libc++ test suite, which includes various types of tests like conformance
tests, vendor-specific tests and benchmarks.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_INCLUDE_BENCHMARKS-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_INCLUDE_BENCHMARKS:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_INCLUDE_BENCHMARKS-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Build the libc++ benchmark tests and the Google Benchmark library needed
to support them.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ASSERTION_HANDLER_FILE-PATH">
<span class="sig-name descname"><span class="pre">LIBCXX_ASSERTION_HANDLER_FILE:PATH</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ASSERTION_HANDLER_FILE-PATH" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>:: <code class="docutils literal notranslate"><span class="pre">&quot;${CMAKE_CURRENT_SOURCE_DIR}/vendor/llvm/default_assertion_handler.in&quot;</span></code></p>
<p>Specify the path to a header that contains a custom implementation of the
assertion handler that gets invoked when a hardening assertion fails. If
provided, this header will be included by the library, replacing the
default assertion handler. If this is specified as a relative path, it
is assumed to be relative to <code class="docutils literal notranslate"><span class="pre">&lt;monorepo&gt;/libcxx</span></code>.</p>
</dd></dl>

</section>
<section id="abi-specific-options">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">ABI Specific Options</a><a class="headerlink" href="#abi-specific-options" title="Link to this heading">¶</a></h3>
<p>The following options allow building libc++ for a different ABI version.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ABI_VERSION-STRING">
<span class="sig-name descname"><span class="pre">LIBCXX_ABI_VERSION:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ABI_VERSION-STRING" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">1</span></code></p>
<p>Defines the target ABI version of libc++.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ABI_UNSTABLE-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ABI_UNSTABLE:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ABI_UNSTABLE-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">OFF</span></code></p>
<p>Build the “unstable” ABI version of libc++. Includes all ABI changing features
on top of the current stable version.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ABI_NAMESPACE-STRING">
<span class="sig-name descname"><span class="pre">LIBCXX_ABI_NAMESPACE:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ABI_NAMESPACE-STRING" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">__n</span></code> where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the current ABI version.</p>
<p>This option defines the name of the inline ABI versioning namespace. It can be used for building
custom versions of libc++ with unique symbol names in order to prevent conflicts or ODR issues
with other libc++ versions.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When providing a custom namespace, it’s the vendor’s responsibility to ensure the name won’t cause
conflicts with other names defined by libc++, both now and in the future. In particular, inline
namespaces of the form <code class="docutils literal notranslate"><span class="pre">__[0-9]+</span></code> could cause conflicts with future versions of the library,
and so should be avoided.</p>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ABI_DEFINES-STRING">
<span class="sig-name descname"><span class="pre">LIBCXX_ABI_DEFINES:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ABI_DEFINES-STRING" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p>
<p>A semicolon-separated list of ABI macros to persist in the site config header.
See <code class="docutils literal notranslate"><span class="pre">include/__config</span></code> for the list of ABI macros.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_CXX_ABI-STRING">
<span class="sig-name descname"><span class="pre">LIBCXX_CXX_ABI:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_CXX_ABI-STRING" title="Link to this definition">¶</a></dt>
<dd><p><strong>Values</strong>: <code class="docutils literal notranslate"><span class="pre">none</span></code>, <code class="docutils literal notranslate"><span class="pre">libcxxabi</span></code>, <code class="docutils literal notranslate"><span class="pre">system-libcxxabi</span></code>, <code class="docutils literal notranslate"><span class="pre">libcxxrt</span></code>, <code class="docutils literal notranslate"><span class="pre">libstdc++</span></code>, <code class="docutils literal notranslate"><span class="pre">libsupc++</span></code>, <code class="docutils literal notranslate"><span class="pre">vcruntime</span></code>.</p>
<p>Select the ABI library to build libc++ against.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_CXX_ABI_INCLUDE_PATHS-PATHS">
<span class="sig-name descname"><span class="pre">LIBCXX_CXX_ABI_INCLUDE_PATHS:PATHS</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_CXX_ABI_INCLUDE_PATHS-PATHS" title="Link to this definition">¶</a></dt>
<dd><p>Provide additional search paths for the ABI library headers.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_CXX_ABI_LIBRARY_PATH-PATH">
<span class="sig-name descname"><span class="pre">LIBCXX_CXX_ABI_LIBRARY_PATH:PATH</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_CXX_ABI_LIBRARY_PATH-PATH" title="Link to this definition">¶</a></dt>
<dd><p>Provide the path to the ABI library that libc++ should link against. This is only
useful when linking against an out-of-tree ABI library.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_STATIC_ABI_LIBRARY-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_STATIC_ABI_LIBRARY:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_STATIC_ABI_LIBRARY-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">OFF</span></code></p>
<p>If this option is enabled, libc++ will try and link the selected ABI library
statically.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXX_ENABLE_ABI_LINKER_SCRIPT-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXX_ENABLE_ABI_LINKER_SCRIPT:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXX_ENABLE_ABI_LINKER_SCRIPT-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code> by default on UNIX platforms other than Apple unless
‘LIBCXX_ENABLE_STATIC_ABI_LIBRARY’ is ON. Otherwise the default value is <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.</p>
<p>This option generate and installs a linker script as <code class="docutils literal notranslate"><span class="pre">libc++.so</span></code> which
links the correct ABI library.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXXABI_USE_LLVM_UNWINDER-BOOL">
<span class="sig-name descname"><span class="pre">LIBCXXABI_USE_LLVM_UNWINDER:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXXABI_USE_LLVM_UNWINDER-BOOL" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">ON</span></code></p>
<p>Build and use the LLVM unwinder. Note: This option can only be used when
libc++abi is the C++ ABI library used.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LIBCXXABI_ADDITIONAL_LIBRARIES-STRING">
<span class="sig-name descname"><span class="pre">LIBCXXABI_ADDITIONAL_LIBRARIES:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LIBCXXABI_ADDITIONAL_LIBRARIES-STRING" title="Link to this definition">¶</a></dt>
<dd><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p>
<p>Additional libraries libc++abi is linked to which can be provided in cache.</p>
</dd></dl>

</section>
<section id="llvm-specific-options">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">LLVM-specific options</a><a class="headerlink" href="#llvm-specific-options" title="Link to this heading">¶</a></h3>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LLVM_LIBDIR_SUFFIX-STRING">
<span class="sig-name descname"><span class="pre">LLVM_LIBDIR_SUFFIX:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LLVM_LIBDIR_SUFFIX-STRING" title="Link to this definition">¶</a></dt>
<dd><p>Extra suffix to append to the directory where libraries are to be
installed. On a 64-bit architecture, one could use <code class="docutils literal notranslate"><span class="pre">-DLLVM_LIBDIR_SUFFIX=64</span></code>
to install libraries to <code class="docutils literal notranslate"><span class="pre">/usr/lib64</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LLVM_BUILD_32_BITS-BOOL">
<span class="sig-name descname"><span class="pre">LLVM_BUILD_32_BITS:BOOL</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LLVM_BUILD_32_BITS-BOOL" title="Link to this definition">¶</a></dt>
<dd><p>Build 32-bits executables and libraries on 64-bits systems. This option is
available only on some 64-bits Unix systems. Defaults to OFF.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-arg-LLVM_LIT_ARGS-STRING">
<span class="sig-name descname"><span class="pre">LLVM_LIT_ARGS:STRING</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-arg-LLVM_LIT_ARGS-STRING" title="Link to this definition">¶</a></dt>
<dd><p>Arguments given to lit.  <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clang-test</span></code> are affected.
By default, <code class="docutils literal notranslate"><span class="pre">'-sv</span> <span class="pre">--no-progress-bar'</span></code> on Visual C++ and Xcode, <code class="docutils literal notranslate"><span class="pre">'-sv'</span></code> on
others.</p>
</dd></dl>

</section>
</section>
<section id="support-for-windows">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Support for Windows</a><a class="headerlink" href="#support-for-windows" title="Link to this heading">¶</a></h2>
<p>Libc++ supports being built with clang-cl, but not with MSVC’s cl.exe, as
cl doesn’t support the <code class="docutils literal notranslate"><span class="pre">#include_next</span></code> extension. Furthermore, VS 2017 or
newer (19.14) is required.</p>
<p>Libc++ also supports being built with clang targeting MinGW environments.</p>
<section id="cmake-visual-studio">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">CMake + Visual Studio</a><a class="headerlink" href="#cmake-visual-studio" title="Link to this heading">¶</a></h3>
<p>Building with Visual Studio currently does not permit running tests. However,
it is the simplest way to build.</p>
<div class="highlight-batch notranslate"><div class="highlight"><pre><span></span><span class="p">&gt;</span> cmake -G <span class="s2">&quot;Visual Studio 16 2019&quot;</span> -S runtimes -B build <span class="se">^</span>
<span class="se"> </span>       -T <span class="s2">&quot;ClangCL&quot;</span>                                    <span class="se">^</span>
<span class="se"> </span>       -DLLVM_ENABLE_RUNTIMES=libcxx                   <span class="se">^</span>
<span class="se"> </span>       -DLIBCXX_ENABLE_SHARED=YES                      <span class="se">^</span>
<span class="se"> </span>       -DLIBCXX_ENABLE_STATIC=NO
<span class="p">&gt;</span> cmake --build build
</pre></div>
</div>
</section>
<section id="cmake-ninja-msvc">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">CMake + ninja (MSVC)</a><a class="headerlink" href="#cmake-ninja-msvc" title="Link to this heading">¶</a></h3>
<p>Building with ninja is required for development to enable tests.
A couple of tests require Bash to be available, and a couple dozens
of tests require other posix tools (cp, grep and similar - LLVM’s tests
require the same). Without those tools the vast majority of tests
can still be ran successfully.</p>
<p>If Git for Windows is available, that can be used to provide the bash
shell by adding the right bin directory to the path, e.g.
<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">PATH=%PATH%;C:\Program</span> <span class="pre">Files\Git\usr\bin</span></code>.</p>
<p>Alternatively, one can also choose to run the whole build in a MSYS2
shell. That can be set up e.g. by starting a Visual Studio Tools Command
Prompt (for getting the environment variables pointing to the headers and
import libraries), and making sure that clang-cl is available in the
path. From there, launch an MSYS2 shell via e.g.
<code class="docutils literal notranslate"><span class="pre">C:\msys64\msys2_shell.cmd</span> <span class="pre">-full-path</span> <span class="pre">-mingw64</span></code> (preserving the earlier
environment, allowing the MSVC headers/libraries and clang-cl to be found).</p>
<p>In either case, then run:</p>
<div class="highlight-batch notranslate"><div class="highlight"><pre><span></span><span class="p">&gt;</span> cmake -G Ninja -S runtimes -B build                                               <span class="se">^</span>
<span class="se"> </span>       -DCMAKE_C_COMPILER=clang-cl                                                 <span class="se">^</span>
<span class="se"> </span>       -DCMAKE_CXX_COMPILER=clang-cl                                               <span class="se">^</span>
<span class="se"> </span>       -DLLVM_ENABLE_RUNTIMES=libcxx
<span class="p">&gt;</span> ninja -C build cxx
<span class="p">&gt;</span> ninja -C build check-cxx
</pre></div>
</div>
<p>If you are running in an MSYS2 shell and you have installed the
MSYS2-provided clang package (which defaults to a non-MSVC target), you
should add e.g. <code class="docutils literal notranslate"><span class="pre">-DCMAKE_CXX_COMPILER_TARGET=x86_64-windows-msvc</span></code> (replacing
<code class="docutils literal notranslate"><span class="pre">x86_64</span></code> with the architecture you’re targeting) to the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command
line above. This will instruct <code class="docutils literal notranslate"><span class="pre">check-cxx</span></code> to use the right target triple
when invoking <code class="docutils literal notranslate"><span class="pre">clang++</span></code>.</p>
</section>
<section id="cmake-ninja-mingw">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">CMake + ninja (MinGW)</a><a class="headerlink" href="#cmake-ninja-mingw" title="Link to this heading">¶</a></h3>
<p>libcxx can also be built in MinGW environments, e.g. with the MinGW
compilers in MSYS2. This requires clang to be available (installed with
e.g. the <code class="docutils literal notranslate"><span class="pre">mingw-w64-x86_64-clang</span></code> package), together with CMake and ninja.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>cmake<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-S<span class="w"> </span>runtimes<span class="w"> </span>-B<span class="w"> </span>build<span class="w">                                               </span><span class="se">\</span>
<span class="w">        </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w">                                                    </span><span class="se">\</span>
<span class="w">        </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w">                                                </span><span class="se">\</span>
<span class="w">        </span>-DLLVM_ENABLE_LLD<span class="o">=</span>ON<span class="w">                                                        </span><span class="se">\</span>
<span class="w">        </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libcxx;libcxxabi&quot;</span><span class="w">                                   </span><span class="se">\</span>
<span class="w">        </span>-DLIBCXXABI_ENABLE_SHARED<span class="o">=</span>OFF<span class="w">                                               </span><span class="se">\</span>
<span class="w">        </span>-DLIBCXX_ENABLE_STATIC_ABI_LIBRARY<span class="o">=</span>ON
&gt;<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>cxx
&gt;<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>check-cxx
</pre></div>
</div>
</section>
</section>
<section id="overriding-the-default-assertion-handler">
<span id="assertion-handler"></span><h2><a class="toc-backref" href="#id13" role="doc-backlink">Overriding the default assertion handler</a><a class="headerlink" href="#overriding-the-default-assertion-handler" title="Link to this heading">¶</a></h2>
<p>When the library wants to terminate due to a hardening assertion failure, the
program is aborted by invoking a trap instruction (or in debug mode, by
a special verbose termination function that prints an error message and calls
<code class="docutils literal notranslate"><span class="pre">std::abort()</span></code>). This is done to minimize the code size impact of enabling
hardening in the library. However, vendors can also override that mechanism at
CMake configuration time.</p>
<p>Under the hood, a hardening assertion will invoke the
<code class="docutils literal notranslate"><span class="pre">_LIBCPP_ASSERTION_HANDLER</span></code> macro upon failure. A vendor may provide a header
that contains a custom definition of this macro and specify the path to the
header via the <code class="docutils literal notranslate"><span class="pre">LIBCXX_ASSERTION_HANDLER_FILE</span></code> CMake variable. If provided,
this header will be included by the library and replace the default
implementation. The header must not include any standard library headers
(directly or transitively) because doing so will almost always create a circular
dependency. The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ASSERTION_HANDLER(message)</span></code> macro takes a single
parameter that contains an error message explaining the hardening failure and
some details about the source location that triggered it.</p>
<p>When a hardening assertion fails, it means that the program is about to invoke
library undefined behavior. For this reason, the custom assertion handler is
generally expected to terminate the program. If a custom assertion handler
decides to avoid doing so (e.g. it chooses to log and continue instead), it does
so at its own risk – this approach should only be used in non-production builds
and with an understanding of potential consequences. Furthermore, the custom
assertion handler should not throw any exceptions as it may be invoked from
standard library functions that are marked <code class="docutils literal notranslate"><span class="pre">noexcept</span></code> (so throwing will result
in <code class="docutils literal notranslate"><span class="pre">std::terminate</span></code> being called).</p>
</section>
<section id="using-alternate-abi-libraries">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Using Alternate ABI libraries</a><a class="headerlink" href="#using-alternate-abi-libraries" title="Link to this heading">¶</a></h2>
<p>In order to implement various features like exceptions, RTTI, <code class="docutils literal notranslate"><span class="pre">dynamic_cast</span></code> and
more, libc++ requires what we refer to as an ABI library. Typically, that library
implements the <a class="reference external" href="https://itanium-cxx-abi.github.io/cxx-abi/abi.html">Itanium C++ ABI</a>.</p>
<p>By default, libc++ uses libc++abi as an ABI library. However, it is possible to use
other ABI libraries too.</p>
<section id="using-libsupc-on-linux">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Using libsupc++ on Linux</a><a class="headerlink" href="#using-libsupc-on-linux" title="Link to this heading">¶</a></h3>
<p>You will need libstdc++ in order to provide libsupc++.</p>
<p>Figure out where the libsupc++ headers are on your system. On Ubuntu this
is <code class="docutils literal notranslate"><span class="pre">/usr/include/c++/&lt;version&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">/usr/include/c++/&lt;version&gt;/&lt;target-triple&gt;</span></code></p>
<p>You can also figure this out by running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>g++<span class="w"> </span>-Wp,-v<span class="w"> </span>-x<span class="w"> </span>c++<span class="w"> </span>-<span class="w"> </span>-fsyntax-only
ignoring<span class="w"> </span>nonexistent<span class="w"> </span>directory<span class="w"> </span><span class="s2">&quot;/usr/local/include/x86_64-linux-gnu&quot;</span>
ignoring<span class="w"> </span>nonexistent<span class="w"> </span>directory<span class="w"> </span><span class="s2">&quot;/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../../x86_64-linux-gnu/include&quot;</span>
<span class="c1">#include &quot;...&quot; search starts here:</span>
<span class="c1">#include &amp;lt;...&amp;gt; search starts here:</span>
/usr/include/c++/4.7
/usr/include/c++/4.7/x86_64-linux-gnu
/usr/include/c++/4.7/backward
/usr/lib/gcc/x86_64-linux-gnu/4.7/include
/usr/local/include
/usr/lib/gcc/x86_64-linux-gnu/4.7/include-fixed
/usr/include/x86_64-linux-gnu
/usr/include
End<span class="w"> </span>of<span class="w"> </span>search<span class="w"> </span>list.
</pre></div>
</div>
<p>Note that the first two entries happen to be what we are looking for. This
may not be correct on all platforms.</p>
<p>We can now run CMake:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cmake<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-S<span class="w"> </span>runtimes<span class="w"> </span>-B<span class="w"> </span>build<span class="w">       </span><span class="se">\</span>
<span class="w">  </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libcxx&quot;</span><span class="w">           </span><span class="se">\</span>
<span class="w">  </span>-DLIBCXX_CXX_ABI<span class="o">=</span>libstdc++<span class="w">                </span><span class="se">\</span>
<span class="w">  </span>-DLIBCXXABI_USE_LLVM_UNWINDER<span class="o">=</span>OFF<span class="w">         </span><span class="se">\</span>
<span class="w">  </span>-DLIBCXX_CXX_ABI_INCLUDE_PATHS<span class="o">=</span><span class="s2">&quot;/usr/include/c++/4.7/;/usr/include/c++/4.7/x86_64-linux-gnu/&quot;</span>
$<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>install-cxx
</pre></div>
</div>
<p>You can also substitute <code class="docutils literal notranslate"><span class="pre">-DLIBCXX_CXX_ABI=libsupc++</span></code>
above, which will cause the library to be linked to libsupc++ instead
of libstdc++, but this is only recommended if you know that you will
never need to link against libstdc++ in the same executable as libc++.
GCC ships libsupc++ separately but only as a static library.  If a
program also needs to link against libstdc++, it will provide its
own copy of libsupc++ and this can lead to subtle problems.</p>
</section>
<section id="using-libcxxrt-on-linux">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Using libcxxrt on Linux</a><a class="headerlink" href="#using-libcxxrt-on-linux" title="Link to this heading">¶</a></h3>
<p>You will need to keep the source tree of <a class="reference external" href="https://github.com/libcxxrt/libcxxrt">libcxxrt</a> available
on your build machine and your copy of the libcxxrt shared library must
be placed where your linker will find it.</p>
<p>We can now run CMake like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cmake<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-S<span class="w"> </span>runtimes<span class="w"> </span>-B<span class="w"> </span>build<span class="w">                               </span><span class="se">\</span>
<span class="w">        </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libcxx&quot;</span><span class="w">                             </span><span class="se">\</span>
<span class="w">        </span>-DLIBCXX_CXX_ABI<span class="o">=</span>libcxxrt<span class="w">                                   </span><span class="se">\</span>
<span class="w">        </span>-DLIBCXX_ENABLE_NEW_DELETE_DEFINITIONS<span class="o">=</span>ON<span class="w">                   </span><span class="se">\</span>
<span class="w">        </span>-DLIBCXXABI_USE_LLVM_UNWINDER<span class="o">=</span>OFF<span class="w">                           </span><span class="se">\</span>
<span class="w">        </span>-DLIBCXX_CXX_ABI_INCLUDE_PATHS<span class="o">=</span>path/to/libcxxrt-sources/src
$<span class="w"> </span>ninja<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>install-cxx
</pre></div>
</div>
<p>Unfortunately you can’t simply run clang with “-stdlib=libc++” at this point, as
clang is set up to link for libc++ linked to libsupc++.  To get around this
you’ll have to set up your linker yourself (or patch clang).  For example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang++<span class="w"> </span>-stdlib<span class="o">=</span>libc++<span class="w"> </span>helloworld.cpp<span class="w"> </span><span class="se">\</span>
<span class="w">          </span>-nodefaultlibs<span class="w"> </span>-lc++<span class="w"> </span>-lcxxrt<span class="w"> </span>-lm<span class="w"> </span>-lc<span class="w"> </span>-lgcc_s<span class="w"> </span>-lgcc
</pre></div>
</div>
<p>Alternately, you could just add libcxxrt to your libraries list, which in most
situations will give the same result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>clang++<span class="w"> </span>-stdlib<span class="o">=</span>libc++<span class="w"> </span>helloworld.cpp<span class="w"> </span>-lcxxrt
</pre></div>
</div>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="UserDocumentation.html">User documentation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="Contributing.html">Contributing to libc++</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2011-2025, LLVM Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>