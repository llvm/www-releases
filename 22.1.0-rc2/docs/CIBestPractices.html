
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>LLVM CI Best Practices &#8212; LLVM 22.1.0-rc2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/llvm-theme.css?v=96924833" />
    <script src="_static/documentation_options.js?v=106f770c"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="LLVM Command Guide" href="CommandGuide/index.html" />
    <link rel="prev" title=".llvm.callgraph Section Layout" href="CallGraphSection.html" />
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
</style>

  </head><body>
<div class="logo">
  <a href="index.html">
    <img src="_static/logo.png"
         alt="LLVM Logo" width="250" height="88"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="CommandGuide/index.html" title="LLVM Command Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="CallGraphSection.html" title=".llvm.callgraph Section Layout"
             accesskey="P">previous</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="Reference.html" accesskey="U">Reference</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">LLVM CI Best Practices</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

<h3>Documentation</h3>

<ul class="want-points">
    <li><a href="https://llvm.org/docs/GettingStartedTutorials.html">Getting Started/Tutorials</a></li>
    <li><a href="https://llvm.org/docs/UserGuides.html">User Guides</a></li>
    <li><a href="https://llvm.org/docs/Reference.html">Reference</a></li>
</ul>

<h3>Getting Involved</h3>

<ul class="want-points">
    <li><a href="https://llvm.org/docs/Contributing.html">Contributing to LLVM</a></li>
    <li><a href="https://llvm.org/docs/HowToSubmitABug.html">Submitting Bug Reports</a></li>
    <li><a href="https://llvm.org/docs/GettingInvolved.html#mailing-lists">Mailing Lists</a></li>
    <li><a href="https://llvm.org/docs/GettingInvolved.html#discord">Discord</a></li>
    <li><a href="https://llvm.org/docs/GettingInvolved.html#meetups-and-social-events">Meetups and Social Events</a></li>
</ul>

<h3>Additional Links</h3>

<ul class="want-points">
    <li><a href="https://llvm.org/docs/FAQ.html">FAQ</a></li>
    <li><a href="https://llvm.org/docs/Lexicon.html">Glossary</a></li>
    <li><a href="https://llvm.org/pubs">Publications</a></li>
    <li><a href="https://github.com/llvm/llvm-project/">Github Repository</a></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/CIBestPractices.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="llvm-ci-best-practices">
<h1>LLVM CI Best Practices<a class="headerlink" href="#llvm-ci-best-practices" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>This document contains a list of guidelines and best practices to use when
working on LLVM’s CI systems. These are intended to keep our actions reliable,
consistent, and secure.</p>
</section>
<section id="github-actions-best-practices">
<h2>GitHub Actions Best Practices<a class="headerlink" href="#github-actions-best-practices" title="Link to this heading">¶</a></h2>
<p>This section contains information on best practices/guidelines when working on
LLVM’s GitHub actions workflows.</p>
<section id="disabling-jobs-in-forks">
<h3>Disabling Jobs In Forks<a class="headerlink" href="#disabling-jobs-in-forks" title="Link to this heading">¶</a></h3>
<p>There are many LLVM forks that exist, and we currently default to preventing
actions from running outside of the LLVM organization to prevent them from
running in forks. We default to this as actions running in forks are usually
not desired and only run by accident. In addition, many of our workflows
assume that they are operating within the main LLVM repository and break
otherwise.</p>
<p>Adhering to this best practice looks like adding the following to each of the
jobs specified within a workflow:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">&lt;job name&gt;</span><span class="p">:</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.repository_owner == &#39;llvm&#39;</span>
</pre></div>
</div>
<p>We choose to use <code class="docutils literal notranslate"><span class="pre">github.repository_owner</span></code> rather than <code class="docutils literal notranslate"><span class="pre">github.repository</span></code>
to enable these workflows to run in forks inside the LLVM organization, such as
the ClangIR fork.</p>
<p>There are some exceptions to this rule where <code class="docutils literal notranslate"><span class="pre">github.repository</span></code> might be
used when it makes sense to limit a workflow to only running in the main
monorepo repository. These include things like the issue subscriber and
release tasks, which should not run anywhere else.</p>
</section>
<section id="hash-pinning-dependencies">
<h3>Hash Pinning Dependencies<a class="headerlink" href="#hash-pinning-dependencies" title="Link to this heading">¶</a></h3>
<p>GitHub Actions allows the use of actions from other repositories as steps in
jobs. We take advantage of various actions for a variety of different tasks,
but especially tasks like checking out the repository, and
downloading/uploading build caches. These actions are typically versioned with
just a release, which looks like the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout LLVM</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</pre></div>
</div>
<p>However, it is best practice to specify an exact commit SHA from which to pull
the action, noting the version in a comment:</p>
<p>We plan on revisiting this recommendation once GitHub’s immutable actions have
been rolled out as GA.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout LLVM</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683</span><span class="w"> </span><span class="c1"># v4.2.2</span>
</pre></div>
</div>
<p>This is beneficial for two reasons: reliability and security. Specifying an
exact SHA rather than just a major version ensures we end up running the same
action originally specified when the workflow was authored and/or updated,
and that no breaking changes sneak in from new versions of a workflow being
released. However, this effect could also be achieved by specifying an exact
dot release. The biggest reason to prefer hash pinned dependencies is security.
Release assets on GitHub are mutable, allowing an attacker to change the code
within a specific version of an action after the fact, potentially stealing
sensitive tokens and credentials. Hash pinning the dependencies prevents this
as the hash would change with the code.</p>
</section>
<section id="using-versioned-runner-images">
<h3>Using Versioned Runner Images<a class="headerlink" href="#using-versioned-runner-images" title="Link to this heading">¶</a></h3>
<p>GitHub actions allows the use of either specifically versioned runner images
(e.g., <code class="docutils literal notranslate"><span class="pre">ubuntu-22.04</span></code>), or just the latest runner image
(e.g., <code class="docutils literal notranslate"><span class="pre">ubuntu-latest</span></code>). It is best practice to use explicitly versioned
runner images. This prevents breakages when GitHub rolls the latest runner
image to a new version with potentially breaking changes, instead allowing us
to explicitly opt-in to using the new image when we have done sufficient
testing to ensure that our existing workflows work as expected in the new
environment.</p>
</section>
<section id="top-level-read-permissions">
<h3>Top Level Read Permissions<a class="headerlink" href="#top-level-read-permissions" title="Link to this heading">¶</a></h3>
<p>The top of every workflow should specify that the job only has read
permissions:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</pre></div>
</div>
<p>If specific jobs within the workflow need additional permissions, those
permissions should be added within the specific job. This practice locks down
all permissions by default and only enables them when needed, better enforcing
the principle of least privilege.</p>
</section>
<section id="ensuring-workflows-run-on-the-correct-events">
<h3>Ensuring Workflows Run on the Correct Events<a class="headerlink" href="#ensuring-workflows-run-on-the-correct-events" title="Link to this heading">¶</a></h3>
<p>GitHub allows workflows to run on a multitude of events, and it is important to
configure a workflow such that it triggers on the correct events. There are
two main best practices around events that trigger workflows:</p>
<p>1. Workflows that are designed to run on pull requests should not be
restricted by target branch. Restricting the target branch unnecessarily
will prevent any stacked PRs from being tested. <code class="docutils literal notranslate"><span class="pre">pull_request</span></code> events should
not contain a branches key.</p>
<p>2. Workflows that are designed to also trigger on push events (e.g., for
testing on <code class="docutils literal notranslate"><span class="pre">main</span></code> or one of the release branches) need to be restricted by
branch. While pushes to a fork will not trigger a workflow run due to the
<code class="docutils literal notranslate"><span class="pre">push</span></code> event if the workflow already has its jobs disabled in forks
(described above), stacked PRs will end up running jobs twice if the <code class="docutils literal notranslate"><span class="pre">push</span></code>
event does not have any branch restrictions. <code class="docutils literal notranslate"><span class="pre">push</span></code> events should have
their branches restricted at the very least to <code class="docutils literal notranslate"><span class="pre">main</span></code> and the release
branches as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">push</span><span class="p">:</span>
<span class="w">  </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">release/*</span>
</pre></div>
</div>
</section>
<section id="make-workflows-run-on-updates-to-the-workflow-definition">
<h3>Make Workflows Run on Updates to the Workflow Definition<a class="headerlink" href="#make-workflows-run-on-updates-to-the-workflow-definition" title="Link to this heading">¶</a></h3>
<p>Whenever possible, workflows should also run whenever the workflow definition
is updated. This enables easily testing the workflow whenever modifying it. For
example, if we have a workflow with a definition in <code class="docutils literal notranslate"><span class="pre">.github/workflows/foo.yaml</span></code>,
we should have at least the following event within the workflow:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">  </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.github/workflows/foo.yaml</span>
</pre></div>
</div>
<p>Note that it is not always possible to enable this (e.g., issues that use a
<code class="docutils literal notranslate"><span class="pre">workflow_run</span></code> trigger). But when possible, this makes testing the workflow
much simpler.</p>
</section>
</section>
<section id="container-best-practices">
<h2>Container Best Practices<a class="headerlink" href="#container-best-practices" title="Link to this heading">¶</a></h2>
<p>This section contains best practices/guidelines when working with containers
for LLVM infrastructure.</p>
<section id="using-fully-qualified-container-names">
<h3>Using Fully Qualified Container Names<a class="headerlink" href="#using-fully-qualified-container-names" title="Link to this heading">¶</a></h3>
<p>When referencing container images from a registry, such as in GitHub Actions
workflows, or in <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> files used for building images, prefer fully
qualified names (i.e., including the registry domain) over just the image.
For example, prefer <code class="docutils literal notranslate"><span class="pre">docker.io/ubuntu:24.04</span></code> over <code class="docutils literal notranslate"><span class="pre">ubuntu:24.04</span></code>. This
ensures portability across systems where a different default registry might
be specified and also prevents attackers from changing the default registry
to pull in a malicious image instead of the intended one.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="CommandGuide/index.html" title="LLVM Command Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="CallGraphSection.html" title=".llvm.callgraph Section Layout"
             >previous</a> |</li>
  <li><a href="https://llvm.org/">LLVM Home</a>&nbsp;|&nbsp;</li>
  <li><a href="index.html">Documentation</a>&raquo;</li>

          <li class="nav-item nav-item-1"><a href="Reference.html" >Reference</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">LLVM CI Best Practices</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2003-2026, LLVM Project.
      Last updated on 2026-01-27.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>