
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Adding New CI Jobs &#8212; libc++ 13.0 documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Feature Test Macro Support" href="FeatureTestMacroTable.html" />
    <link rel="prev" title="libc++ Format Status" href="Status/Format.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>libc++ 13.0 documentation</span></a></h1>
        <h2 class="heading"><span>Adding New CI Jobs</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="Status/Format.html">libc++ Format Status</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="FeatureTestMacroTable.html">Feature Test Macro Support</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <div class="section" id="adding-new-ci-jobs">
<span id="addingnewcijobs"></span><h1>Adding New CI Jobs<a class="headerlink" href="#adding-new-ci-jobs" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#adding-the-job" id="id1">Adding The Job</a></p></li>
<li><p><a class="reference internal" href="#testing-your-new-job" id="id2">Testing Your New Job</a></p></li>
<li><p><a class="reference internal" href="#service-level-agreement" id="id3">Service Level Agreement</a></p></li>
</ul>
</div>
<div class="section" id="adding-the-job">
<h2><a class="toc-backref" href="#id1">Adding The Job</a><a class="headerlink" href="#adding-the-job" title="Permalink to this headline">¶</a></h2>
<p>libc++ uses Buildkite for running its CI. Setting up new CI jobs is easy, and
these jobs can run either on our existing infrastructure, or on your own.</p>
<p>If you need to run the job on your own machines, please follow the
<a class="reference external" href="https://buildkite.com/docs/agent/v3">Buildkite guide</a> to setup your
own agents. Make sure you tag your agents in a way that you’ll be able
to recognize them when defining your job below. Finally, in order for the
agent to register itself to Buildkite, it will need a BuildKite Agent token.
Please contact a maintainer to get your token.</p>
<p>Then, simply add a job to the Buildkite pipeline by editing <code class="docutils literal notranslate"><span class="pre">libcxx/utils/ci/buildkite-pipeline.yml</span></code>.
Take a look at how the surrounding jobs are defined and do something similar.
An example of a job definition is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">label</span><span class="p">:</span> <span class="s">&quot;C++11&quot;</span>
  <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;libcxx/utils/ci/run-buildbot</span><span class="nv"> </span><span class="s">generic-cxx11&quot;</span>
  <span class="nt">artifact_paths</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;**/test-results.xml&quot;</span>
  <span class="nt">agents</span><span class="p">:</span>
    <span class="nt">queue</span><span class="p">:</span> <span class="s">&quot;libcxx-builders&quot;</span>
    <span class="nt">os</span><span class="p">:</span> <span class="s">&quot;linux&quot;</span>
  <span class="nt">retry</span><span class="p">:</span>
    <span class="nt">automatic</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">exit_status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">-1</span>  <span class="c1"># Agent was lost</span>
        <span class="nt">limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>
</div>
<p>If you create your own agents, put them in the <code class="docutils literal notranslate"><span class="pre">libcxx-builders</span></code> queue and
use agent tags to allow targetting your agents from the Buildkite pipeline
config appropriately.</p>
<p>We try to keep the pipeline definition file as simple as possible, and to
keep any script used for CI inside <code class="docutils literal notranslate"><span class="pre">libcxx/utils/ci</span></code>. This ensures that
it’s possible to reproduce CI issues locally with ease, understanding of
course that some setups may require access to special hardware that is not
available.</p>
</div>
<div class="section" id="testing-your-new-job">
<h2><a class="toc-backref" href="#id2">Testing Your New Job</a><a class="headerlink" href="#testing-your-new-job" title="Permalink to this headline">¶</a></h2>
<p>Testing your new job is easy – once your agent is set up (if any), just open
a code review and the libc++ CI pipeline will run, including any changes you
might have made to the pipeline definition itself.</p>
</div>
<div class="section" id="service-level-agreement">
<h2><a class="toc-backref" href="#id3">Service Level Agreement</a><a class="headerlink" href="#service-level-agreement" title="Permalink to this headline">¶</a></h2>
<p>To keep the libc++ CI useful for everyone, we aim for a quick turnaround time
for all CI jobs. This allows the overall pipeline to finish in a reasonable
amount of time, which is important because it directly affects our development
velocity. We also try to make sure that jobs run on reliable infrastructure in
order to avoid flaky failures, which reduce the value of CI for everyone.</p>
<p>We may be reluctant to add and support CI jobs that take a long time to finish
or that are too flaky.</p>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="Status/Format.html">libc++ Format Status</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="FeatureTestMacroTable.html">Feature Test Macro Support</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2021, LLVM Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.2.
    </div>
  </body>
</html>